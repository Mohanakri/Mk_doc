# Chapter 7: Networking with Linux

## Overview

Linux networking encompasses network communication layers, sockets and ports, network services and protocols, and network security. This chapter provides essential concepts for both novice and advanced users.

### Topics Covered
- Basic networking fundamentals
- Working with network services
- Understanding network security
- Practical Linux network configuration

---

## 1. Exploring Basic Networking

### Computer Networks

A **computer network** is a group of two or more computers (nodes) connected via a physical medium and communicating using standard protocols.

#### Network Components
- **Physical Infrastructure**: Cables, wireless, optical connections
- **Network Equipment**: Switches, routers, devices
- **Logical Layout**: Network topologies, tiers, data flow

#### Network Device Identification
- **Network Addresses**: IP addresses for locating nodes
- **Hostnames**: User-friendly labels for devices

### Network Classifications

#### Local Area Networks (LANs)
- **Definition**: Devices connected in a single physical location
- **Examples**: Home networks, office networks, coffee shop WiFi
- **Characteristics**: Single, limited area coverage
- **Scale**: From few devices to thousands of users

#### Wide Area Networks (WANs)
- **Definition**: Network of networks spanning multiple regions
- **Examples**: Internet (world's largest WAN), multinational company networks
- **Variations**: 
  - Personal Area Networks (PANs)
  - Metropolitan Area Networks (MANs)
  - Cloud/Internet Area Networks (IANs)

---

## 2. The OSI Model

The **Open Systems Interconnection (OSI)** model is a theoretical framework for network communications, introduced in 1983 by ISO.

![OSI Model Structure](Figure_7.1_OSI_model.png)

### OSI Seven Layers

#### Layer 1: Physical Layer
- **Function**: Raw bit streams and communication medium conversion
- **Components**: Cables, wireless, optical environments, switches
- **Protocols**: Ethernet, USB, DSL
- **Responsibility**: Electrical, radio, or optical signal handling

#### Layer 2: Data Link Layer
- **Function**: Reliable data flow between directly connected devices
- **Components**: 
  - **MAC (Media Access Control)**: Device identification and access permissions
  - **LLC (Logical Link Control)**: Protocol identification and error checking
- **Data Units**: Frames
- **Protocols**: PPP (Point-to-Point Protocol)

#### Layer 3: Network Layer
- **Function**: Optimal communication path discovery and routing
- **Responsibility**: IP-based routing between devices
- **Data Units**: Packets
- **Protocols**: ICMP (Internet Control Message Protocol)

#### Layer 4: Transport Layer
- **Function**: Data transfer with Quality of Service (QoS)
- **Responsibilities**: Flow control, error control, data segmentation
- **Data Units**: Segments/Datagrams
- **Protocols**: TCP, UDP

#### Layer 5: Session Layer
- **Function**: Connection channel lifetime management
- **Components**: Network addresses, sockets, ports
- **Protocols**: RPC, NetBIOS
- **Features**: Session integrity, checkpoint recovery

#### Layer 6: Presentation Layer
- **Function**: Data translation between application and session layers
- **Operations**: Encryption/decryption, compression, encoding
- **Formats**: ASCII, XML, JSON, JPEG, ZIP

#### Layer 7: Application Layer
- **Function**: Interface between applications and network
- **Note**: Contains communication components, not applications themselves
- **Protocols**: DNS, HTTP, FTP, SMTP, POP, IMAP

### Data Encapsulation and Decapsulation

![Encapsulation Process](Figure_7.2_Encapsulation_Decapsulation.png)

#### Encapsulation (Sending Data)
1. **Layer 7-5**: Data formatting and session management
2. **Layer 4**: Data segmentation + TCP header
3. **Layer 3**: Packet creation + IP header
4. **Layer 2**: Frame creation + MAC addresses + FCS
5. **Layer 1**: Physical transmission

#### Decapsulation (Receiving Data)
1. **Layer 1**: Physical reception and synchronization
2. **Layer 2**: Error checking via CRC (Cyclic Redundancy Check)
3. **Layer 3-7**: Header removal and data reconstruction

---

## 3. TCP/IP Network Stack Model

The **TCP/IP model** is a four-layer practical interpretation of the OSI model, predating OSI and forming the foundation of the internet.

![OSI vs TCP/IP Models](Figure_7.3_OSI_TCP-IP_models.png)

### TCP/IP Four Layers

#### Network Interface Layer
- **Function**: Physical data delivery
- **Protocols**: Ethernet, Token Ring, Frame Relay
- **OSI Equivalent**: Physical + Data Link layers

#### Internet Layer
- **Function**: Connectionless data delivery and routing
- **Responsibility**: Packet disassembly/reassembly
- **OSI Equivalent**: Network layer

#### Transport Layer
- **Function**: Communication session maintenance
- **Features**: Error detection and correction
- **OSI Equivalent**: Transport layer

#### Application Layer
- **Function**: Software-network abstraction
- **OSI Equivalent**: Session + Presentation + Application layers

---

## 4. TCP/IP Protocols

### Core Protocols

| Protocol | RFC | Layer | Function |
|----------|-----|-------|----------|
| **IP** | 791 | 3 | Node identification via IP addresses |
| **ARP** | 826 | 2 | IPv4 to MAC address mapping |
| **NDP** | 4861 | 2 | IPv6 address mapping |
| **ICMP** | 792 | 3 | Transmission error reporting |
| **TCP** | 793 | 4 | Reliable, connection-oriented communication |
| **UDP** | 768 | 4 | Connectionless, best-effort communication |

### Application Layer Protocols

| Protocol | RFC | Port | Function |
|----------|-----|------|----------|
| **DHCP** | 2131 | 67/68 | Dynamic IP address allocation |
| **DNS** | 2929 | 53 | Domain name resolution |
| **HTTP** | 2616 | 80 | Web communication |
| **FTP** | 959 | 21 | File transfer |
| **SSH** | 4253 | 22 | Secure remote access |
| **TELNET** | 854 | 23 | Insecure remote access |
| **SMTP** | 5321 | 25 | Email sending |
| **SNMP** | 1157 | 161 | Network management |
| **NTP** | 5905 | 123 | Time synchronization |

---

## 5. IP Addresses

### IPv4 Addresses

**Format**: 32-bit number expressed as four 8-bit groups separated by dots
**Example**: `192.168.1.53`
**Address Space**: ~4.3 billion addresses (2^32)

![IPv4 Structure](Figure_7.4_Network_classes.png)

### Network Classes

![Network Classes](Figure_7.5_Network_classes.png)

| Class | Range | Default Mask | Usage |
|-------|-------|--------------|-------|
| **A** | 1-126 | 255.0.0.0 (/8) | Large networks |
| **B** | 128-191 | 255.255.0.0 (/16) | Medium networks |
| **C** | 192-223 | 255.255.255.0 (/24) | Small networks |
| **D** | 224-239 | N/A | Multicast |
| **E** | 240-255 | N/A | Reserved |

### Subnetting

![Subnet Example](Figure_7.6_Subnet_network_host.png)

#### CIDR Notation
- **Format**: `network_address/prefix_length`
- **Example**: `192.168.1.0/24`
- **Meaning**: First 24 bits are network, last 8 bits are host

#### Subnet Calculation Example
```
Original: 192.168.1.53
Network: 192.168.1.0/24
Range: 192.168.1.1 - 192.168.1.254
Broadcast: 192.168.1.255
```

### IPv6 Addresses

**Format**: 128-bit number expressed as eight 16-bit hexadecimal groups
**Example**: `2001:0b8d:8a52:0000:0000:8b2d:0240:7235`
**Shortened**: `2001:b8d:8a52::8b2d:240:7235/64`

#### IPv6 Features
- **Address Space**: 2^128 addresses
- **Prefix Length**: Equivalent to CIDR notation (1-128)
- **Zero Compression**: `::` replaces consecutive zero groups

---

## 6. Sockets and Ports

### Network Sockets
- **Definition**: Software data structure representing network communication endpoint
- **Linux Implementation**: File descriptor controlled via network API
- **Components**: IP address + Port number
- **Lifetime**: Tied to creating process

### Network Ports
- **Range**: 0-65535
- **Well-known Ports**: 0-1024 (system services)
- **Ephemeral Ports**: 1024+ (general use)

#### Common Well-known Ports
| Port | Service | Protocol |
|------|---------|----------|
| 21 | FTP | TCP |
| 22 | SSH | TCP |
| 25 | SMTP | TCP |
| 53 | DNS | TCP/UDP |
| 67/68 | DHCP | UDP |
| 80 | HTTP | TCP |
| 443 | HTTPS | TCP |

---

## 7. Linux Network Configuration

### Retrieving Current IP Information
```bash
ip addr show
```

![IP Address Display](Figure_7.7_IP_addresses_ip_command.png)

### Ubuntu Network Configuration (netplan)

#### Configuration File Location
```bash
ls /etc/netplan/
# Usually: 00-installer-config.yaml
```

#### Dynamic IP Configuration
```yaml
# /etc/netplan/00-installer-config.yaml
network:
  version: 2
  ethernets:
    ens33:
      dhcp4: true
```

![DHCP Configuration](Figure_7.8_DHCP_netplan.png)

#### Static IP Configuration
```yaml
# /etc/netplan/00-installer-config.yaml
network:
  version: 2
  ethernets:
    ens33:
      dhcp4: false
      addresses:
        - 192.168.122.22/24
      gateway4: 192.168.122.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```

![Static IP Configuration](Figure_7.10_Static_IP_netplan.png)

#### Apply Configuration
```bash
sudo netplan try      # Test configuration
sudo netplan apply    # Apply configuration
```

![Netplan Testing](Figure_7.9_Testing_netplan.png)

### Fedora/RHEL Network Configuration (nmcli)

#### View Connections
```bash
nmcli connection show
```

![nmcli Connection Info](Figure_7.11_nmcli_connection_info.png)

#### Dynamic IP Configuration
```bash
sudo nmcli connection modify 'Wired connection 1' ipv4.method auto
```

![nmcli DHCP Config](Figure_7.12_nmcli_keyfile.png)

#### Static IP Configuration
```bash
# Set static IP
sudo nmcli connection modify 'Wired connection 1' ipv4.address 192.168.122.3/24

# Restart connection
sudo nmcli connection down 'Wired connection 1'
sudo nmcli connection up 'Wired connection 1'

# Set gateway and DNS
sudo nmcli connection modify 'Wired connection 1' ipv4.gateway 192.168.122.1
sudo nmcli connection modify 'Wired connection 1' ipv4.dns 8.8.8.8

# Disable DHCP
sudo nmcli connection modify 'Wired connection 1' ipv4.method manual

# Restart connection
sudo nmcli connection down 'Wired connection 1'
sudo nmcli connection up 'Wired connection 1'
```

![New IP Address](Figure_7.13_New_IP_address.png)

![Static Configuration Keyfile](Figure_7.14_Static_keyfile.png)

### openSUSE Network Configuration (Wicked)

#### Check Active Service
```bash
sudo systemctl status network
```

![Network Service Status](Figure_7.15_openSUSE_network_service.png)

![Wicked Server Status](Figure_7.16_Wicked_server.png)

#### View Network Information
```bash
wicked show all
sudo wicked show-config
```

![Wicked Device Info](Figure_7.17_Wicked_devices.png)

![Wicked Config Location](Figure_7.18_Wicked_config_location.png)

![Wicked Config Content](Figure_7.19_Wicked_config_content.png)

![Wicked Detailed Info](Figure_7.20_Wicked_detailed_info.png)

#### Static IP Configuration
```bash
# /etc/sysconfig/network/ifcfg-eth0
BOOTPROTO='static'
STARTMODE='auto'
IPADDR='192.168.122.144'
ZONE='public'
PREFIXLEN='24'
```

![Static IP Variables](Figure_7.22_Static_IP_variables.png)

```bash
sudo systemctl restart wickedd.service
sudo wicked ifup eth0
```

![New Static IP](Figure_7.23_New_static_IP.png)

### Hostname Configuration

#### View Hostname
```bash
hostname
hostnamectl
```

#### Change Hostname
```bash
sudo hostnamectl set-hostname earth
```

![Hostname Commands](Figure_7.24_Hostname_commands.png)

#### Edit Configuration Files
```bash
sudo nano /etc/hostname
sudo nano /etc/hosts
```

![Hostname Files](Figure_7.25_Hostname_files.png)

---

## 8. Network Services

### DHCP Servers

#### Function
- Dynamic IP address allocation using DHCP protocol
- Operates initially at Layer 2 (broadcast discovery)
- Uses UDP ports 67 (server) and 68 (client)

#### Querying DHCP Server
```bash
ip route
```

![DHCP Server Query](Figure_7.26_DHCP_server_query.png)

#### Features
- **IP Leasing**: Time-limited address assignments
- **Lease Renewal**: Automatic address retention
- **Configuration Data**: MAC addresses, domain servers

### DNS Servers

#### Function
- Convert hostnames to IP addresses
- Distributed global network of name servers
- Uses TCP/UDP port 53

#### DNS Server Types
1. **Recursive Servers**: Caching resolvers
2. **Root Servers**: Top-level domain references
3. **TLD Servers**: Top-level domain authorities
4. **Authoritative Servers**: Domain-specific records

#### DNS Tools

##### Check Local DNS Server
```bash
cat /etc/resolv.conf | grep nameserver
```

![DNS Server Query](Figure_7.27_DNS_server_query.png)

##### nslookup Usage
```bash
# Install on Ubuntu/Debian
sudo apt install dnsutils

# Install on Fedora
sudo dnf install bind-utils

# Query domain
nslookup neptune.local
```

![nslookup Local](Figure_7.28_nslookup_local.png)

```bash
# Interactive mode
nslookup
> wikipedia.org
```

![nslookup Interactive](Figure_7.29_nslookup_interactive.png)

```bash
# Reverse lookup
nslookup 8.8.8.8
```

![nslookup Reverse](Figure_7.30_nslookup_reverse.png)

##### dig Usage
```bash
# Forward lookup
dig google.com
```

![dig Forward](Figure_7.31_dig_forward.png)

```bash
# Reverse lookup
dig -x 8.8.4.4
```

![dig Reverse](Figure_7.32_dig_reverse.png)

### Authentication Servers

Authentication servers provide centralized credential validation for network resources.

![LDAP Authentication Workflow](Figure_7.33_LDAP_authentication.png)

#### Common Authentication Platforms
- **Kerberos**: MIT-developed authentication protocol
- **LDAP**: Lightweight Directory Access Protocol
- **RADIUS**: Remote Authentication Dial-In User Service
- **Diameter**: Enhanced RADIUS successor
- **TACACS+**: Terminal Access Controller Access-Control System

### File Sharing Services

#### Protocol Comparison

| Protocol | Platform | Description |
|----------|----------|-------------|
| **SMB** | Microsoft | Network discovery, file/printer sharing |
| **CIFS** | Legacy | SMB implementation (deprecated) |
| **Samba** | Linux | SMB implementation for Linux servers |
| **NFS** | Unix/Linux | Sun Microsystems network file system |
| **AFP** | macOS | Apple Filing Protocol (proprietary) |

#### Protocol Selection
- **Linux Networks**: NFS preferred
- **Mixed Environments**: Samba/SMB recommended
- **Legacy Support**: CIFS (not recommended)

### File Transfer Services

#### FTP (File Transfer Protocol)
- **Control Connection**: Port 21
- **Data Connections**: Dynamic ports
- **Modes**: Active (PORT) and Passive (PASV)

#### Secure Variants
- **FTPS**: FTP over SSL/TLS (port 990)
- **SFTP**: FTP over SSH (port 22)

### Mail Servers

#### Email Protocols

##### POP3 (Post Office Protocol v3)
- **Function**: Download emails to local client
- **Ports**: 110 (insecure), 995 (secure)
- **Behavior**: Usually removes emails from server

##### IMAP (Internet Message Access Protocol)
- **Function**: Access emails on server
- **Ports**: 143 (insecure), 993 (secure)
- **Behavior**: Emails remain on server

##### SMTP (Simple Mail Transfer Protocol)
- **Function**: Send emails
- **Ports**: 25 (insecure), 465/587 (secure)

#### SMTP Example
```bash
# Connect to Gmail SMTP
openssl s_client -starttls smtp -connect smtp.gmail.com:587
```

![SMTP TLS Handshake](Figure_7.34_SMTP_TLS_handshake.png)

```
# SMTP commands
HELO hellogoogle
```

![SMTP Ready](Figure_7.35_SMTP_ready.png)

### NTP Servers

#### Function
- Network Time Protocol for clock synchronization
- Synchronizes to Coordinated Universal Time (UTC)
- Uses UDP port 123

#### Installation and Setup (Ubuntu)
```bash
# Install NTP utilities
sudo apt install ntp ntpstat ntpdate

# Check service status
sudo systemctl status ntp
sudo systemctl enable ntp

# Configure firewall
sudo ufw allow from any to any port 123 proto udp

# Restart service
sudo systemctl restart ntp
```

#### Check Synchronization
```bash
ntpstat
```

![NTP Status](Figure_7.36_NTP_status.png)

```bash
# Identify NTP server
dig -x 31.209.85.242
```

![NTP Server Info](Figure_7.37_NTP_server_info.png)

### Remote Access Services

#### SSH (Secure Shell)

##### Authentication Types
1. **Public-key Authentication**
2. **Password Authentication**
3. **Keyboard-interactive Authentication**

##### Public-key Authentication Models

###### User-based Authentication
![User-based SSH](Figure_7.38_User_based_SSH.png)
- Each user has individual SSH key
- Multiple users, multiple keys per host

###### Host-based Authentication
![Host-based SSH](Figure_7.39_Host_based_SSH.png)
- Single SSH key per system
- Multiple users can use same host key

##### SSH Workflow
1. Client generates key pair (ssh-keygen)
2. Public key shared with server
3. Server verifies public key during handshake
4. Encrypted communication established

#### TELNET
- **Function**: Plaintext remote terminal access
- **Security**: Insecure (no encryption)
- **Use Cases**: Protocol troubleshooting, legacy systems
- **Port**: 23

#### VNC (Virtual Network Computing)
- **Function**: Remote desktop access
- **Protocol**: Remote Framebuffer (RFB)
- **Cross-platform**: Windows, macOS, Linux clients/servers
- **Requirement**: GUI desktop environment

---

## 9. Network Security

### Security Paradigms

#### Access Control
- User authentication and authorization
- Users, groups, and permissions
- Multi-factor authentication

#### Application Security
- SELinux (Security-Enhanced Linux)
- Encrypted connections (TLS/SSL)
- Antivirus and anti-malware

#### Endpoint Security
- Firewalls (iptables, firewalld)
- Intrusion detection systems
- Device compliance policies

#### Network Segmentation
- VLANs (Virtual LANs)
- Network isolation
- Micro-segmentation

#### VPN (Virtual Private Networks)
- Encrypted tunnels over public networks
- Site-to-site connectivity
- Remote access security

### Security Implementation Approach
1. **Access Control**: Start with user/group permissions
2. **Application Security**: Secure individual services
3. **Endpoint Security**: Configure firewalls and IDS
4. **Network Segmentation**: Implement VLANs
5. **VPN**: Establish secure remote access

---

## Summary

This chapter covered fundamental Linux networking concepts including:

- **OSI and TCP/IP Models**: Theoretical frameworks for network communication
- **IP Addressing**: IPv4/IPv6 addressing, subnetting, and CIDR notation
- **Network Configuration**: Platform-specific tools (netplan, nmcli, Wicked)
- **Network Services**: DHCP, DNS, authentication, file sharing, email, NTP, remote access
- **Network Security**: Access control, application security, endpoint protection

### Key Takeaways
- Linux networking involves multiple layers of abstraction
- Different distributions use different network management tools
- Network services work together to provide complete functionality
- Security should be implemented at multiple levels
- Understanding protocols and ports is essential for troubleshooting

### Next Steps
- Chapter 8: Linux Shell Scripting
- Chapter 10: Disaster Recovery and Troubleshooting (firewalls)
- Chapter 13: Configuring Linux Servers (practical implementations)

---

## Quick Reference

### Essential Commands
```bash
# Network information
ip addr show
ip route

# Hostname management
hostname
hostnamectl set-hostname <name>

# DNS tools
nslookup <domain>
dig <domain>
dig -x <ip_address>

# Network testing
ping <host>
traceroute <host>
```

### Configuration Files
```bash
# Ubuntu (netplan)
/etc/netplan/00-installer-config.yaml

# Fedora/RHEL (NetworkManager)
/etc/NetworkManager/system-connections/

# openSUSE (Wicked)
/etc/sysconfig/network/

# General
/etc/hostname
/etc/hosts
/etc/resolv.conf
```

### Port Reference
| Service | Port | Protocol |
|---------|------|----------|
| FTP | 21 | TCP |
| SSH | 22 | TCP |
| TELNET | 23 | TCP |
| SMTP | 25 | TCP |
| DNS | 53 | TCP/UDP |
| DHCP | 67/68 | UDP |
| HTTP | 80 | TCP |
| NTP | 123 | UDP |
| HTTPS | 443 | TCP |
| SMTP (TLS) | 587 | TCP |
| IMAPS | 993 | TCP |
| POP3S | 995 | TCP |