# Chapter 2: The Linux Shell and Filesystem

## Overview

Understanding the Linux filesystem, file management fundamentals, and the basics of the Linux shell and command-line interface (CLI) is essential for a modern-day Linux professional.

## Learning Objectives

By the end of this chapter, you will:
- Be comfortable using the Linux CLI
- Understand the structure of basic Linux commands
- Know how the Linux filesystem is organized
- Master various commands for working with files and directories
- Be familiar with common command-line text editors

## Main Topics Covered

1. Introducing the Linux shell
2. The Linux filesystem
3. Working with files and directories
4. Using text editors to create and edit files

---

## 1. Introducing the Linux Shell

### What is the Shell?

The shell is a program that has two streams:
- **Input stream**: Command given by the user
- **Output stream**: Result of that command or interpretation

The shell is the primary interface between the user and the machine.

### Bash Shell

The main shell in major Linux distributions is **Bash** (Bourne Again Shell), named after Steve Bourne, the original creator of the shell in UNIX.

#### Other Available Shells
- ksh
- tcsh
- zsh

!!! note "Distribution Default Shells"
    - **Bash by default**: Debian, Ubuntu, Fedora, CentOS Stream, RHEL, openSUSE, SLE, Linux Mint
    - **zsh by default**: Kali Linux, some Manjaro editions, macOS

### Checking Your Default Shell

#### Method 1: Check /etc/passwd file
```bash
cat /etc/passwd | grep username
```

#### Method 2: Using echo command
```bash
echo $0
```

![Figure 2.1 – Commands used to see the running shell](images/figure_2_1.png)

### Viewing All Installed Shells

```bash
cat /etc/shells
```

![Figure 2.2 – The shells available by default in Ubuntu](images/figure_2_2.png)

!!! warning "Case Sensitivity"
    The Linux shell is case-sensitive. Commands like `cat` must be typed in lowercase. `Cat` or `CAT` will not be recognized.

### Shell Connection Types

#### TTY (Teletypewriter)
- Native connection with direct ports to your computer
- Direct connection through keyboard (native terminal device)

#### PTS (Pseudo Terminal Slave)
- Generated by SSH or Telnet connections
- Emulated connection made by programs like ssh or xterm

### Virtual Consoles/Terminals

Virtual consoles are accessible and run in the background. Access them using:

- **Ctrl + Alt + F1** → tty1
- **Ctrl + Alt + F2** → tty2
- **Ctrl + Alt + F3** → tty3
- **Ctrl + Alt + F4** → tty4
- **Ctrl + Alt + F5** → tty5
- **Ctrl + Alt + F6** → tty6
- **Ctrl + Alt + F7** → X graphical mode (desktop editions)

#### Alternative Method: chvt Command
```bash
sudo chvt N  # N = terminal number
```

#### Check Current Users and Terminals
```bash
who
```

### Command-Line Prompt

The command-line prompt shows:
- Username
- Hostname
- Present working directory
- User type symbol

#### Examples:

**Ubuntu/Debian style:**
```
packt@saturn:~$
```

**Fedora/RHEL style:**
```
[packt@localhost ~]$
```

**openSUSE style:**
```
packt@localhost:~>
```

#### Prompt Components:
- `packt` = username
- `saturn`/`localhost` = hostname
- `~` = home directory (tilde)
- `$` = regular user (`#` for administrator)
- `>` = openSUSE prompt symbol

### Shell Command Types

#### Internal Commands
Built inside the shell (shell builtins)

#### External Commands
Installed separately

#### Checking Command Type
```bash
type command_name
```

Example:
```bash
type cd
# Output: cd is a shell builtin
```

![Figure 2.3 – Different types of commands in Linux](images/figure_2_3.png)

### Command Structure

```bash
command [-option(s)] [argument(s)]
```

#### Example: ls command
```bash
ls                    # Basic usage
ls -l                 # With option (long format)
ls -l ~/Documents/    # With option and argument
```

![Figure 2.4 – Using the ls command with both options and attributes](images/figure_2_4.png)

### Consulting the Manual

#### man command
```bash
man command_name
```

#### Help option
```bash
command_name --help
```

#### Getting help about help
```bash
man man
help help
```

!!! tip "Manual Best Practices"
    - Use man pages as your first resource before searching online
    - The manual is technical documentation, not a step-by-step guide
    - Practice reading man pages to become proficient
    - Manual pages are available offline when internet access is limited

---

## 2. The Linux Filesystem

### Filesystem Structure

The Linux filesystem consists of a logical collection of files stored on partitions or disks. It uses a hierarchical structure similar to an upside-down tree, with the root (`/`) at the base.

### Filesystem Hierarchy Standard (FHS)

The FHS defines the structure of Unix-like filesystems.

### Exploring with Commands

#### Install tree command (Ubuntu)
```bash
sudo apt install tree
```

#### Basic tree usage
```bash
tree -L 1 /  # Show one level down from root
```

![Figure 2.5 – Comparing the output of ls -la commands and tree -a commands](images/figure_2_5.png)

![Figure 2.6 – The tree command with option and argument on Ubuntu](images/figure_2_6.png)

### Linux Root Filesystem Directory Structure

| Directory | Purpose |
|-----------|---------|
| `/` | Root directory - the root for all other directories |
| `/bin` | Essential command binaries - binary programs storage |
| `/boot` | Static files of boot loader - kernel, bootloader, initramfs |
| `/dev` | Device files - nodes to device equipment, kernel device list |
| `/etc` | Host-specific system configuration - essential config files |
| `/home` | User home directories - where user files are stored |
| `/lib` | Essential shared libraries and kernel modules |
| `/media` | Mount point for removable media - external devices, USB |
| `/mnt` | Mount point for temporarily mounting filesystems |
| `/opt` | Add-on application software packages - optional software |
| `/proc` | Virtual filesystem managed by kernel - special directory structure |
| `/sbin` | Essential system binaries - vital system operation programs |
| `/srv` | Data for services provided by this system |
| `/tmp` | Temporary files |
| `/usr` | Secondary hierarchy - largest directory containing user support files |
| `/var` | Variable data - modifiable user data, databases, logs |

#### /usr Subdirectories:
- `/usr/bin` – system-executable files
- `/usr/lib` – shared libraries from /usr/bin
- `/usr/local` – source compiled programs not in distribution
- `/usr/sbin` – specific system administration programs
- `/usr/share` – shared data (config files, icons, wallpapers, sounds)
- `/usr/share/doc` – documentation for system-wide files

#### /var Subdirectories:
- `/var/log` – log files that register system activity

---

## 3. Working with Files and Directories

!!! important "Everything is a File"
    In Linux, everything is a file, including directories.

### Understanding File Paths

#### Absolute Path
Always starts with root directory and follows branches to desired file.

Example: `/home/packt/poem`

#### Relative Path
Always refers to present working directory (pwd) and represents path relative to it.

Example: `poem` (when already in home directory)

#### Special Characters for Relative Paths
- `.` (dot) = current directory
- `..` (two dots) = parent directory

![Figure 2.7 – Using the relative path of a file](images/figure_2_7.png)

!!! tip "Tab Completion"
    Always use the Tab key for autocompletion and to check if the path you typed is correct.

### Basic File Operations

#### Creating Files

##### Using touch command
```bash
touch filename
```

![Figure 2.8 – Using the touch command to create and alter files](images/figure_2_8.png)

##### Changing access time
```bash
touch -a filename
ls -la --time=atime filename  # View access time
```

![Figure 2.9 – Using touch to alter the access time](images/figure_2_9.png)

##### Using echo with redirection
```bash
echo "text content" > filename      # Create/overwrite
echo "more content" >> filename     # Append
```

![Figure 2.10 – Using echo with output redirection](images/figure_2_10.png)

#### Listing Files

| Command | Description |
|---------|-------------|
| `ls -lh` | Long format with human-readable sizes |
| `ls -la` | Long format showing all files (including hidden) |
| `ls -ltr` | Sort by modification time, newest first, then reverse |
| `ls -lS` | Sort by size, largest first |
| `ls -R` | Recursive listing |

##### Long Listing Format Explanation
```bash
drwxr-x--- 5 packt packt 4096 Mar  2 14:44 .
```

- First character: file type (`d`=directory, `-`=file, `l`=link, etc.)
- Next 9 characters: permissions
- Number: hard links
- First name: owner (PID)
- Second name: group (GID)
- Number: file size
- Date/time: last modification
- Last: filename

#### Copying and Moving Files

##### Basic copy
```bash
cp source_file destination_file
```

##### Copy options
| Option | Description |
|--------|-------------|
| `cp -a` | Copy entire directory hierarchy recursively, preserve attributes |
| `cp -r` | Recursive copy, doesn't preserve attributes |
| `cp -p` | Retain file permissions and timestamps |
| `cp -R` | Copy directory recursively |

![Figure 2.11 – Using the copy command with the -a option](images/figure_2_11.png)

![Figure 2.12 – Using the cp -R command](images/figure_2_12.png)

##### Moving/Renaming files
```bash
mv old_name new_name     # Rename
mv file /path/to/dest/   # Move
```

#### Working with Links

##### Symbolic Links
```bash
ln -s original_filename link_filename
```

![Figure 2.13 – Using symbolic links](images/figure_2_13.png)

##### Check inode differences
```bash
ls -i filename link_name
```

![Figure 2.14 – Comparing the inodes for the symbolic link and original file](images/figure_2_14.png)

##### Check link destination
```bash
readlink link_name
```

##### Hard Links
```bash
ln original_file linked_file
```

![Figure 2.15 – Working with hard links](images/figure_2_15.png)

#### Deleting Files

| Command | Description |
|---------|-------------|
| `rm -i` | Interactive mode - asks before deleting |
| `rm -f` | Force delete without interaction |
| `rm -r` | Recursive delete for directories |

![Figure 2.16 – Removing a file interactively](images/figure_2_16.png)

![Figure 2.17 – Force remove a file](images/figure_2_17.png)

![Figure 2.18 – Remove a directory recursively](images/figure_2_18.png)

!!! danger "Caution with rm -rf"
    The `rm -rf` command is extremely destructive and will delete files and directories without warning. There's no going back once executed.

#### Creating Directories

```bash
mkdir directory_name
mkdir -p parent/child/grandchild  # Create parent directories
```

![Figure 2.19 – Creating parent directories](images/figure_2_19.png)

#### Deleting Directories

```bash
rmdir directory_name  # Only works with empty directories
```

![Figure 2.20 – Using the rmdir command](images/figure_2_20.png)

### Commands for File Viewing

#### cat command
```bash
cat filename                    # View single file
cat file1 file2                # View multiple files
```

![Figure 2.21 – Example of using the cat command](images/figure_2_21.png)

#### less command
```bash
less filename
```

**Navigation keys in less:**
- **Space**: Move forward one screen
- **Enter**: Move forward one line
- **b**: Move backward one screen
- **/**: Search forward
- **?**: Search backward
- **v**: Edit with default editor
- **g**: Jump to beginning
- **Shift+G**: Jump to end
- **q**: Exit

#### head command
```bash
head filename           # Show first 10 lines
head -n 5 filename     # Show first 5 lines
head -5 filename       # Alternative syntax
```

![Figure 2.22 – Using the head command](images/figure_2_22.png)

#### tail command
```bash
tail filename           # Show last 10 lines
tail -n 5 filename     # Show last 5 lines
tail -f filename       # Follow file changes (real-time)
tail -F filename       # Follow with log rotation handling
```

![Figure 2.23 – The use of tail command for real-time log file observation](images/figure_2_23.png)

### Commands for File Properties

#### stat command
```bash
stat filename
```

![Figure 2.24 – Using the stat command](images/figure_2_24.png)

#### file command
```bash
file filename
```

![Figure 2.25 – Using the file command](images/figure_2_25.png)

### File Ownership and Permissions

#### Understanding Permissions

![Figure 2.26 – Long listing output](images/figure_2_26.png)

##### Permission Types:
- **r** = read (4)
- **w** = write (2)
- **x** = execute (1)
- **-** = no permission (0)

##### File Types:
- **d** = directory
- **-** = regular file
- **l** = symbolic link
- **p** = named pipe
- **s** = socket
- **b** = block device
- **c** = character device

##### Permission Structure:
```
rwxr-xr-x
|||╰─ other permissions (r-x = 4+1 = 5)
||╰── group permissions (r-x = 4+1 = 5)  
|╰─── owner permissions (rwx = 4+2+1 = 7)
╰──── file type
```

![Figure 2.27 – File permissions explained](images/figure_2_27.png)

##### Permission Examples to Practice:
Convert these to octal:
- `rwxrwx---` = 770
- `rwxr-x---` = 750
- `rwxr-xr--` = 754
- `rwx------` = 700
- `rw-rw-rw-` = 666
- `rw-rw-r--` = 664
- `rw-rw----` = 660
- `rw-r--r--` = 644
- `rw-r-----` = 640
- `rw-------` = 600
- `r--------` = 400

### File Compression and Archiving

#### tar command options

| Option | Description |
|--------|-------------|
| `-c` | Create archive |
| `-r` | Append files to existing archive |
| `-u` | Append only changed files |
| `-A` | Append archive to another archive |
| `-t` | List archive contents |
| `-x` | Extract archive contents |
| `-z` | Use gzip compression |
| `-j` | Use bzip2 compression |
| `-v` | Verbose mode |
| `-p` | Restore original permissions |
| `-f` | Specify output filename |

#### Creating Archives

##### Basic archive
```bash
tar -cvf archive_name.tar directory/
```

![Figure 2.28 – Using the tar command](images/figure_2_28.png)

##### Compressed archive
```bash
tar -czvf archive_name.tar.gz directory/
```

![Figure 2.29 – Compressing a tar archive using gzip](images/figure_2_29.png)

#### Extracting Archives

##### Basic extraction
```bash
mkdir target_directory
tar -xvf archive_name.tar -C target_directory
```

##### Compressed extraction
```bash
tar -xzvf archive_name.tar.gz -C target_directory
```

### Commands for Locating Files

#### locate command

##### Installation (Ubuntu)
```bash
sudo apt install mlocate
```

##### Update database
```bash
sudo updatedb
```

##### Search for files
```bash
locate filename
```

![Figure 2.30 – Using the locate command](images/figure_2_30.png)

![Figure 2.31 – Using the locate command with output redirection and the wc command](images/figure_2_31.png)

#### which command
```bash
which command_name
```

Example:
```bash
which ls
# Output: /usr/bin/ls
```

#### whereis command
```bash
whereis command_name
```

![Figure 2.32 – Using the whereis command](images/figure_2_32.png)

#### find command

The most powerful file search command with 50+ options.

##### Basic syntax
```bash
find /path -criteria -action
```

##### Common find examples:

**Find by name:**
```bash
sudo find / -name "filename" -print
```

**Find by type:**
```bash
sudo find / -name "pattern" -type f -print
```

**Find in multiple directories:**
```bash
sudo find /opt /usr /var -name "pattern" -type f -print
```

**Find by extension:**
```bash
sudo find / -type f -name "*.conf"
```

**Find multiple extensions:**
```bash
sudo find / -type f \( -name "*.c" -o -name "*.sh" -o -name "*.py" \) > findfile
```

**Find by permissions:**
```bash
sudo find / -type f -perm 0664
sudo find / -type f -perm /u=r    # Read-only for owner
sudo find / -type f -perm /a=x    # Executable
```

**Find by time:**
```bash
sudo find / -type f -mtime 2      # Modified exactly 2 days ago
sudo find / -type f -atime -2     # Accessed within last 2 days
sudo find / -type f -mtime +2 -mtime -5  # Modified 2-5 days ago
sudo find / -type f -mmin -10     # Modified within last 10 minutes
sudo find / -type f -cmin -10     # Created within last 10 minutes
sudo find / -type f -amin -10     # Accessed within last 10 minutes
```

**Find by size:**
```bash
sudo find / -type f -size 5M              # Exactly 5MB
sudo find / -type f -size +5M -size -10M  # Between 5-10MB
```

**Find empty files/directories:**
```bash
sudo find / -type f -empty
sudo find / -type d -empty
```

**Find largest files:**
```bash
sudo find /etc -type f -exec ls -l {} \; | sort -n -r | head -5
```

**Find smallest files:**
```bash
sudo find /etc -type f -exec ls -s {} \; | sort -n | head -5
```

### Text Manipulation Commands

#### grep command

One of the most powerful text search commands.

##### Common options:

| Option | Description |
|--------|-------------|
| `-v` | Show lines NOT matching criteria |
| `-l` | Show only filenames that match |
| `-L` | Show only filenames that don't match |
| `-c` | Count matching lines |
| `-n` | Show line numbers |
| `-i` | Case insensitive search |
| `-r` | Search recursively |
| `-R` | Search recursively and follow symlinks |
| `-E` | Use extended regular expressions |
| `-F` | Use strict strings instead of regex |

##### Examples:

**Search in log files:**
```bash
sudo grep sudo /var/log/auth.log
```

**Recursive search:**
```bash
grep -R "search_term" /etc
grep -Rn "search_term" /etc    # With line numbers
grep -Rh "search_term" /etc    # Hide filenames
grep -Rl "search_term" /etc    # Show only filenames
```

**With pipes:**
```bash
ls -la | grep '^d'              # Show only directories
cat /proc/cpuinfo | grep -i 'Model'  # Show CPU model
```

#### tee command

Copies standard input to standard output AND to files.

```bash
command | tee [-a] filename
```

![Figure 2.33 – Using the tee command](images/figure_2_33.png)

---

## 4. Using Text Editors

### Vim Text Editor

Vim is a mode-based editor with different operation modes.

#### Vim Modes:
- **Command mode**: Default mode, waiting for commands
- **Insert mode**: Text insertion mode
- **Replace mode**: Text replacement mode
- **Search mode**: Special mode for searching

#### Switching Between Modes:

**To Insert Mode:**
- **i** = Insert at cursor position
- **a** = Append after cursor position

**To Replace Mode:**
- **r** = Replace single character
- **R** = Replace mode

**To Search Mode:**
- **/** = Search forward
- **?** = Search backward

**To Command Mode:**
- **Esc** = Return to command mode from any other mode

**To Ex Command Mode:**
- **:** = Enter last line mode for commands like save/quit

#### Navigation (Command Mode):
- **Arrow keys** or **h,j,k,l** = Left, Down, Up, Right
- **w** = Move forward by word
- **b** = Move backward by word
- **0** = Beginning of line
- **$** = End of line
- **gg** = Beginning of file
- **G** = End of file

#### Basic Vim Commands:

![Figure 2.34 – Basic Vim commands](images/figure_2_34.png)

**File Operations:**
- **:w** = Save file
- **:q** = Quit
- **:wq** = Save and quit
- **:q!** = Quit without saving

**Editing:**
- **x** = Delete character under cursor
- **dd** = Delete current line
- **yy** = Copy current line
- **p** = Paste
- **u** = Undo
- **Ctrl+r** = Redo

### nano Text Editor

nano is a simpler, more user-friendly text editor that comes pre-installed on most Linux distributions.

#### Check Default Editor:
```bash
sudo update-alternatives --display editor
```

![Figure 2.35 – Checking the default text editor on Ubuntu](images/figure_2_35.png)

#### Using nano:
```bash
nano filename
```

nano displays available commands at the bottom of the screen with **Ctrl** key combinations.

**Common nano shortcuts:**
- **Ctrl+X** = Exit
- **Ctrl+O** = Save (WriteOut)
- **Ctrl+G** = Help
- **Ctrl+W** = Search
- **Ctrl+K** = Cut line
- **Ctrl+U** = Paste line
- **Ctrl+C** = Show cursor position

---

## Summary

This chapter covered essential Linux shell and filesystem concepts:

✅ **Shell Basics**: Understanding Bash, command types, and prompt structure
✅ **Filesystem Structure**: Learning the FHS and directory hierarchy  
✅ **File Operations**: Creating, copying, moving, deleting files and directories
✅ **File Viewing**: Using cat, less, head, tail for content viewing
✅ **File Properties**: Understanding permissions, ownership, and file types
✅ **File Location**: Using find, locate, which, whereis commands
✅ **Text Manipulation**: Basic grep and tee usage
✅ **Text Editors**: Introduction to Vim and nano

These fundamental skills form the foundation for Linux system administration and will be used throughout your Linux journey.

---

## Practice Questions

1. **Archive Creation**: What command creates a compressed archive with all files inside the /etc directory that use the .conf extension?

2. **File Sorting**: What command lists the first five files inside /etc and sorts them by size in descending order?

3. **Directory Creation**: What command creates a hierarchical directory structure?

4. **Multi-Extension Search**: What command searches for files with three different extensions inside the root directory?

5. **SUID Files**: Find out which commands in Linux have the Set owner User ID (SUID) set up.

6. **Random File Generation**: Which command creates a file with 1,000 lines of randomly generated words?

7. **Number Generation**: How do you generate a file with 1,000 randomly generated numbers?

8. **Sudo History**: How do you find out when sudo was last used and which commands were executed?

---

## Further Reading

- **Fundamentals of Linux** by Oliver Pelz
- **Mastering Ubuntu Server – Fourth Edition** by Jay LaCroix
- Linux man pages: `man bash`, `man find`, `man grep`
- Vim documentation: https://vimdoc.sourceforge.net/