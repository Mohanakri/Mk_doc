# AWS Storage Gateway Study Notes

aws ended this services , continue to support existing customers as of now.

## Overview

AWS Storage Gateway is a hybrid cloud storage service that connects on-premises environments to AWS Cloud storage services.

### Key Characteristics

- Enables hybrid storage between on-premises and AWS Cloud
- Provides low-latency performance by caching frequently accessed data on-premises
- Stores data securely and durably in Amazon cloud storage services
- Implemented using a virtual machine (VM) running on-premises
- Supports VMware or Hyper-V virtual appliances
- Provides local storage resources backed by Amazon S3 and Glacier

### Common Use Cases

- Disaster recovery preparedness
- Data synchronization to AWS
- Hybrid cloud storage architectures
- Backup and archival solutions

### Security Features

- All data transferred between gateway appliance and AWS storage is encrypted using SSL
- By default, all data stored in S3 is encrypted server-side with Amazon S3-Managed Encryption Keys (SSE-S3)
- File gateway supports optional AWS KMS-Managed Keys encryption using SSE-KMS

## Gateway Types and Interfaces

AWS Storage Gateway supports three storage interfaces: **file**, **volume**, and **tape**.

| New Name | Old Name | Interface | Use Case |
|----------|----------|-----------|----------|
| **File Gateway** | None | NFS, SMB | Allow on-premises or EC2 instances to store objects in S3 via NFS or SMB mount points |
| **Volume Gateway Stored Mode** | Gateway-Stored Volumes | iSCSI | Asynchronous replication of on-premises data to S3 |
| **Volume Gateway Cached Mode** | Gateway-Cached Volumes | iSCSI | Primary data stored in S3 with frequently accessed data cached locally on-premises |
| **Tape Gateway** | Gateway-Virtual Tape Library | iSCSI | Virtual media changer and tape library for use with existing backup software |

**Important**: Each gateway can provide only **one type of interface**.

## File Gateway

### Overview
- Provides a virtual on-premises file server
- Enables storing and retrieving files as objects in Amazon S3
- Used for flat files only, stored directly on S3
- Offers SMB or NFS-based access to data in Amazon S3 with local caching

### Supported Applications
- On-premises applications
- Amazon EC2-resident applications needing file storage in S3 for object-based workloads

### Protocol Support
- **NFS**: Supports NFS v3 and v4.1
- **SMB**: Microsoft Windows clients that support SMB can connect

### Storage Classes Supported
- Amazon S3 Standard
- S3 Standard – Infrequent Access (S3 Standard – IA)
- S3 One Zone – IA

### Limitations
- Maximum size of individual file: **5 TB**

## Volume Gateway

### Overview
- Represents the family of gateways supporting block-based volumes
- Previously referred to as gateway-cached and gateway-stored modes
- Uses **iSCSI-based block storage**

### Operating Modes

#### Cached Volume Mode
- **Primary storage**: Entire dataset stored on S3
- **Local storage**: Cache of most frequently accessed data cached on-site
- **Volume capacity**: Each volume up to **32 TB**
- **Total capacity**: Maximum **1 PB** per gateway (32 volumes × 32 TB each)

#### Stored Volume Mode
- **Primary storage**: Entire dataset stored on-site
- **Backup**: Asynchronously backed up to S3 as EBS point-in-time snapshots
- **Snapshot characteristics**: Incremental and compressed
- **Volume capacity**: Each volume up to **16 TB**
- **Total capacity**: Maximum **512 TB** per gateway (32 volumes × 16 TB each)

### Volume Specifications
- Each volume gateway can support up to **32 volumes**

## Tape Gateway (Gateway Virtual Tape Library)

### Overview
- Used for backup with popular backup software
- Each gateway preconfigured with media changer and tape drives
- Compatible with backup software like NetBackup, Backup Exec, Veeam, etc.

### Virtual Tape Specifications

#### Available Tape Sizes
- 100 GB
- 200 GB
- 400 GB
- 800 GB
- 1.5 TB
- 2.5 TB

#### Capacity Limits
- Up to **1,500 virtual tapes** per gateway
- Maximum aggregate capacity: **1 PB**

## Gateway Management

### Maintenance Operations

Different procedures for different gateway types when performing maintenance (patches, updates, etc.):

#### File Gateway
1. Simply shut down the VM

#### Volume and Tape Gateways
1. Stop the gateway
2. Reboot the VM
3. Start the gateway

### VM Maintenance Requirements
- May need to shut down or reboot VM for maintenance
- Examples: applying hypervisor patches
- Must follow proper shutdown procedures to avoid data loss

## Monitoring

### Key CloudWatch Metrics

AWS Storage Gateway provides several metrics for monitoring cache usage and performance:

| Metric | Description | Applies To | Unit |
|--------|-------------|------------|------|
| **CacheHitPercent** | Percent of application reads served from the cache. Sample taken at end of reporting period. | File, cached-volume, and tape gateways | Percent |
| **CacheUsed** | Total number of bytes being used in the gateway's cache storage. Sample taken at end of reporting period. | File, cached-volume, and tape gateways | Bytes |

### Monitoring Best Practices
- Monitor cache hit percentage to optimize performance
- Track cache usage to ensure adequate local storage
- Set up CloudWatch alarms for critical metrics
- Regular monitoring helps identify performance bottlenecks

## Architecture Considerations

### Deployment Requirements
- Virtual machine must be deployed on-premises
- Supported hypervisors: VMware or Hyper-V
- Adequate local storage for caching
- Network connectivity to AWS services

### Performance Optimization
- Size cache storage appropriately based on workload
- Monitor cache hit ratios and adjust cache size if needed
- Consider network bandwidth for data transfer to AWS
- Local cache improves performance for frequently accessed data

### High Availability
- Consider redundant gateway deployments for critical workloads
- Regular backups and disaster recovery planning
- Monitor gateway health and performance metrics

## Use Case Selection Guide

### Choose File Gateway When:
- Need file-based access (NFS/SMB) to S3 objects
- Working with flat files
- Integrating with existing file-based applications
- Need cross-platform file sharing

### Choose Volume Gateway Cached Mode When:
- Primary dataset can be stored in S3
- Need block-based access (iSCSI)
- Frequently accessed data subset fits in local cache
- Want to minimize on-premises storage costs

### Choose Volume Gateway Stored Mode When:
- Need primary data stored on-premises for performance
- Want asynchronous backup to S3
- Have existing block-based applications
- Require immediate local access to all data

### Choose Tape Gateway When:
- Using existing backup software
- Need virtual tape library functionality
- Want to eliminate physical tape infrastructure
- Require long-term archival capabilities

## Security Best Practices

### Data Protection
- All data encrypted in transit using SSL
- Server-side encryption enabled by default (SSE-S3)
- Consider SSE-KMS for additional key management control
- Regular security updates for gateway VM

### Access Control
- Implement proper IAM policies for AWS resources
- Secure network access to gateway VM
- Use VPC endpoints where appropriate
- Monitor access logs and API calls

## Cost Optimization

### Storage Costs
- Leverage S3 storage classes based on access patterns
- Use lifecycle policies for automatic tier transitions
- Monitor storage usage and optimize data retention
- Consider data deduplication where applicable

### Data Transfer
- Optimize cache size to minimize data transfer
- Use AWS Direct Connect for high-volume transfers
- Monitor CloudWatch metrics to identify cost optimization opportunities