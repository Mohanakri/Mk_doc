# AWS EBS Real-Time Tasks - Step by Step Console Manual

## Task 1: Create and Attach EBS Volume to Running EC2 Instance

### Step 1: Create EBS Volume

#### Console Steps:
1. **Login to AWS Console** → **EC2 Dashboard**
2. **Left panel** → **Elastic Block Store** → **Volumes**
3. **Create Volume** button
4. **Configure Volume**:
   - **Volume Type**: `gp3` (General Purpose SSD)
   - **Size**: `20 GiB`
   - **IOPS**: `3000` (default)
   - **Throughput**: `125 MiB/s` (default)
   - **Availability Zone**: **Same as your EC2 instance** (e.g., us-east-1a)
   - **Snapshot ID**: Leave blank
   - **Encryption**: ✅ **Encrypt this volume**
   - **KMS Key**: `Default (aws/ebs)`
5. **Add Tags**:
   - Key: `Name`, Value: `WebServer-Data-Volume`
   - Key: `Environment`, Value: `Production`
6. **Create Volume**

### Step 2: Attach Volume to EC2 Instance

#### Console Steps:
1. **Select the created volume** → **Actions** → **Attach Volume**
2. **Instance**: Select your EC2 instance from dropdown
3. **Device**: `/dev/sdf` (will appear as `/dev/xvdf` in instance)
4. **Attach Volume**

### Step 3: Connect to EC2 and Mount Volume

#### SSH to EC2 Instance:
```bash
ssh -i your-key.pem ec2-user@your-instance-ip
```

#### Check Available Disks:
```bash
# List block devices
lsblk

# Check file systems
sudo fdisk -l
```

#### Format and Mount the Volume:
```bash
# Create file system (ext4)
sudo mkfs -t ext4 /dev/xvdf

# Create mount point
sudo mkdir /data

# Mount the volume
sudo mount /dev/xvdf /data

# Verify mount
df -h
```

#### Make Mount Permanent:
```bash
# Get UUID of the volume
sudo blkid /dev/xvdf

# Edit fstab
sudo nano /etc/fstab

# Add line (replace UUID with actual UUID):
UUID=your-uuid-here /data ext4 defaults,nfail 0 2

# Test fstab
sudo mount -a
```

---

## Task 2: Create EBS Snapshot and Restore

### Step 1: Create Snapshot

#### Console Steps:
1. **EC2 Console** → **Volumes** → **Select volume**
2. **Actions** → **Create Snapshot**
3. **Configure Snapshot**:
   - **Description**: `WebServer-Data-Backup-2024-07-31`
   - **Tags**:
     - Key: `Name`, Value: `Daily-Backup-WebServer`
     - Key: `Backup-Date`, Value: `2024-07-31`
     - Key: `Retention`, Value: `30-days`
4. **Create Snapshot**

### Step 2: Monitor Snapshot Progress

#### Console Steps:
1. **Left panel** → **Snapshots**
2. **Find your snapshot** → Check **Status** column
3. **Wait for status**: `pending` → `completed`

### Step 3: Create Volume from Snapshot

#### Console Steps:
1. **Select snapshot** → **Actions** → **Create Volume from Snapshot**
2. **Configure New Volume**:
   - **Volume Type**: `gp3`
   - **Size**: `20 GiB` (can be larger than original)
   - **Availability Zone**: `us-east-1b` (different AZ for testing)
   - **Encryption**: ✅ **Encrypt this volume**
3. **Create Volume**

### Step 4: Launch New EC2 Instance with Restored Volume

#### Console Steps:
1. **EC2 Dashboard** → **Launch Instance**
2. **Name**: `WebServer-Restored`
3. **AMI**: Amazon Linux 2
4. **Instance Type**: t3.micro
5. **Key Pair**: Select existing key
6. **Security Group**: Select existing or create new
7. **Advanced Details** → **Storage**:
   - **Root volume**: 8 GiB gp3
   - **Add Volume**: Select the volume created from snapshot
8. **Launch Instance**

---

## Task 3: EBS Volume Resize (Online)

### Step 1: Modify Volume Size

#### Console Steps:
1. **EC2 Console** → **Volumes** → **Select volume**
2. **Actions** → **Modify Volume**
3. **Size**: Change from `20 GiB` to `40 GiB`
4. **Volume Type**: Keep as `gp3`
5. **IOPS**: `6000` (increase with size)
6. **Throughput**: `250 MiB/s`
7. **Modify** → **Yes, Modify**

### Step 2: Extend File System (Without Reboot)

#### SSH to Instance:
```bash
# Check current partition size
df -h /data

# Check block device
lsblk

# Extend file system (for ext4)
sudo resize2fs /dev/xvdf

# For XFS file system, use:
# sudo xfs_growfs /data

# Verify new size
df -h /data
```

---

## Task 4: EBS Multi-Attach Setup (io1/io2 only)

### Step 1: Create Multi-Attach Enabled Volume

#### Console Steps:
1. **EC2 Console** → **Volumes** → **Create Volume**
2. **Configure Volume**:
   - **Volume Type**: `io2`
   - **Size**: `100 GiB`
   - **IOPS**: `1000`
   - **Multi-Attach**: ✅ **Enable Multi-Attach**
   - **Availability Zone**: `us-east-1a`
   - **Encryption**: ✅ **Encrypt this volume**
3. **Create Volume**

### Step 2: Attach to Multiple Instances

#### Console Steps:
1. **Select volume** → **Actions** → **Attach Volume**
2. **Instance**: Select first EC2 instance
3. **Device**: `/dev/sdf`
4. **Attach Volume**
5. **Repeat for second instance**:
   - **Actions** → **Attach Volume**
   - **Instance**: Select second EC2 instance
   - **Device**: `/dev/sdf`
   - **Attach Volume**

### Step 3: Configure Cluster File System

#### On Both Instances:
```bash
# Install cluster-aware file system (example: GFS2)
sudo yum install -y gfs2-utils

# Create cluster file system
sudo mkfs.gfs2 -j 2 -p lock_dlm -t mycluster:shared /dev/xvdf

# Mount with cluster options
sudo mkdir /shared
sudo mount -t gfs2 /dev/xvdf /shared
```

---

## Task 5: EBS Encryption Migration

### Step 1: Create Encrypted Snapshot from Unencrypted Volume

#### Console Steps:
1. **Volumes** → **Select unencrypted volume**
2. **Actions** → **Create Snapshot**
3. **Description**: `Unencrypted-to-Encrypted-Migration`
4. **Create Snapshot**
5. **Wait for completion**

### Step 2: Copy Snapshot with Encryption

#### Console Steps:
1. **Snapshots** → **Select created snapshot**
2. **Actions** → **Copy Snapshot**
3. **Destination Region**: Same region
4. **Encryption**: ✅ **Encrypt this snapshot**
5. **KMS Key**: Select encryption key
6. **Copy Snapshot**

### Step 3: Create Encrypted Volume

#### Console Steps:
1. **Select encrypted snapshot** → **Actions** → **Create Volume**
2. **Configure Volume**:
   - **Volume Type**: `gp3`
   - **Size**: Same as original
   - **Availability Zone**: Same as original instance
3. **Create Volume**

### Step 4: Replace Volume (Requires Downtime)

#### Console Steps:
1. **Stop EC2 instance**
2. **Detach original volume**:
   - **Select old volume** → **Actions** → **Detach Volume**
3. **Attach encrypted volume**:
   - **Select encrypted volume** → **Actions** → **Attach Volume**
   - **Device**: Same device name as original
4. **Start EC2 instance**

---

## Task 6: EBS Performance Monitoring and Optimization

### Step 1: Enable Detailed Monitoring

#### Console Steps:
1. **EC2 Console** → **Instances** → **Select instance**
2. **Actions** → **Monitor and troubleshoot** → **Manage detailed monitoring**
3. **Enable** → **Confirm**

### Step 2: Check EBS Metrics in CloudWatch

#### Console Steps:
1. **CloudWatch Console** → **Metrics** → **EC2**
2. **Per-Volume Metrics**:
   - **VolumeReadOps**: Read operations per second
   - **VolumeWriteOps**: Write operations per second
   - **VolumeQueueLength**: Queue length
   - **VolumeThroughputPercentage**: Throughput percentage
   - **VolumeConsumedReadWriteOps**: Consumed IOPS

### Step 3: Performance Testing

#### SSH to Instance:
```bash
# Install fio for performance testing
sudo yum install -y fio

# Test random read IOPS
sudo fio --filename=/dev/xvdf --direct=1 --rw=randread --bs=4k --ioengine=libaio --iodepth=256 --runtime=120 --numjobs=4 --time_based --group_reporting --name=iops-test-job --eta-newline=1

# Test sequential write throughput
sudo fio --filename=/dev/xvdf --direct=1 --rw=write --bs=1M --ioengine=libaio --iodepth=4 --runtime=120 --numjobs=4 --time_based --group_reporting --name=throughput-test-job --eta-newline=1

# Test with file system (mounted volume)
sudo fio --filename=/data/testfile --direct=1 --rw=randrw --bs=4k --ioengine=libaio --iodepth=32 --runtime=60 --numjobs=2 --time_based --group_reporting --name=mixed-test-job --eta-newline=1 --size=1G
```

---

## Task 7: EBS Volume Migration Across AZs

### Step 1: Create Snapshot

#### Console Steps:
1. **Volumes** → **Select source volume**
2. **Actions** → **Create Snapshot**
3. **Description**: `Migration-to-AZ-B`
4. **Create Snapshot**

### Step 2: Create Volume in Target AZ

#### Console Steps:
1. **Snapshots** → **Select migration snapshot**
2. **Actions** → **Create Volume from Snapshot**
3. **Availability Zone**: Select target AZ (e.g., us-east-1b)
4. **Create Volume**

### Step 3: Launch Instance in Target AZ

#### Console Steps:
1. **Launch Instance**:
   - **Subnet**: Select subnet in target AZ
   - **Storage**: Don't add additional storage during launch
2. **After launch**, attach the migrated volume

---

## Task 8: EBS Cost Optimization

### Step 1: Identify Underutilized Volumes

#### Console Steps:
1. **EC2 Console** → **Volumes**
2. **Check Status**: Look for `available` volumes (unattached)
3. **CloudWatch** → **EBS Metrics**:
   - Look for volumes with low IOPS usage
   - Check `VolumeIdleTime` metric

### Step 2: Convert gp2 to gp3

#### Console Steps:
1. **Select gp2 volume** → **Actions** → **Modify Volume**
2. **Volume Type**: Change to `gp3`
3. **IOPS**: Set to `3000` (baseline)
4. **Throughput**: Set to `125 MiB/s`
5. **Modify** → **Yes, Modify**

### Step 3: Implement Lifecycle Management

#### Create Snapshot Lifecycle Policy:
1. **EC2 Console** → **Lifecycle Manager**
2. **Create Lifecycle Policy**
3. **Policy Type**: EBS Snapshot Policy
4. **Target Resources**: Volumes with specific tags
5. **Schedule**:
   - **Frequency**: Daily
   - **Time**: 03:00 UTC
   - **Retention**: 7 snapshots
6. **Create Policy**

---

## Task 9: EBS Troubleshooting Common Issues

### Issue 1: Volume Not Visible After Attach

#### Check Steps:
```bash
# SSH to instance
lsblk
dmesg | tail
sudo fdisk -l

# If not visible, check:
# 1. Correct AZ
# 2. Instance is running
# 3. Device name conflicts
```

### Issue 2: Performance Issues

#### Console Diagnosis:
1. **CloudWatch** → **EBS Metrics**
2. Check **VolumeQueueLength** (should be < 32)
3. Check **VolumeThroughputPercentage** (should be < 80%)
4. **EBS-Optimized**: Ensure instance is EBS-optimized

#### Instance Check:
```bash
# Check I/O statistics
iostat -x 1

# Check if EBS-optimized
curl http://169.254.169.254/latest/meta-data/instance-id
# Then check in EC2 console
```

### Issue 3: Mount Failures

#### Troubleshooting:
```bash
# Check file system
sudo fsck /dev/xvdf

# Check mount points
mount | grep xvdf

# Check fstab syntax
sudo mount -a

# View system logs
sudo tail -f /var/log/messages
```

---

## Task 10: EBS Automation with AWS CLI

### Automated Snapshot Creation Script:
```bash
#!/bin/bash

# Variables
VOLUME_ID="vol-1234567890abcdef0"
DESCRIPTION="Automated-Daily-Backup-$(date +%Y-%m-%d)"

# Create snapshot
SNAPSHOT_ID=$(aws ec2 create-snapshot \
    --volume-id $VOLUME_ID \
    --description "$DESCRIPTION" \
    --tag-specifications 'ResourceType=snapshot,Tags=[{Key=Name,Value=Daily-Backup},{Key=CreatedBy,Value=Automation}]' \
    --query 'SnapshotId' \
    --output text)

echo "Created snapshot: $SNAPSHOT_ID"

# Wait for completion
aws ec2 wait snapshot-completed --snapshot-ids $SNAPSHOT_ID
echo "Snapshot completed successfully"
```

### Volume Monitoring Script:
```bash
#!/bin/bash

# Get volume metrics
aws cloudwatch get-metric-statistics \
    --namespace AWS/EBS \
    --metric-name VolumeReadOps \
    --dimensions Name=VolumeId,Value=vol-1234567890abcdef0 \
    --statistics Sum \
    --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
    --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
    --period 3600
```

---

## Quick Reference Commands

### Linux Commands for EBS:
```bash
# List block devices
lsblk

# Check file systems
df -h

# Check disk usage
du -sh /path

# Format volume
sudo mkfs -t ext4 /dev/xvdf

# Mount volume
sudo mount /dev/xvdf /mnt

# Unmount volume
sudo umount /mnt

# Check file system
sudo fsck /dev/xvdf

# Resize file system
sudo resize2fs /dev/xvdf
```

### AWS CLI Commands:
```bash
# List volumes
aws ec2 describe-volumes

# Create volume
aws ec2 create-volume --size 10 --volume-type gp3 --availability-zone us-east-1a

# Attach volume
aws ec2 attach-volume --volume-id vol-xxx --instance-id i-xxx --device /dev/sdf

# Create snapshot
aws ec2 create-snapshot --volume-id vol-xxx --description "My snapshot"

# Modify volume
aws ec2 modify-volume --volume-id vol-xxx --size 20
```

---

## Best Practices Summary

1. **Always backup** before major changes
2. **Use appropriate volume types** for workload
3. **Enable encryption** for sensitive data
4. **Monitor performance** with CloudWatch
5. **Implement lifecycle policies** for cost optimization
6. **Tag resources** for better management
7. **Test disaster recovery** procedures regularly
8. **Use EBS-optimized instances** for better performance