# Amazon EFS Interview Questions

## Basic Level Questions

### 1. What is Amazon EFS and what are its key features?
**Answer:**
Amazon EFS (Elastic File System) is a fully managed NFS (Network File System) for EC2 instances. Key features include:
- Scalable storage that grows/shrinks automatically
- Multiple EC2 instances can access simultaneously
- POSIX-compliant file system
- Multi-AZ availability
- Pay-as-you-use pricing
- Encryption at rest and in transit
- Integration with AWS services

### 2. What is the difference between EBS and EFS?
**Answer:**
| Feature | EBS | EFS |
|---------|-----|-----|
| **Attachment** | Single EC2 instance | Multiple instances simultaneously |
| **Protocol** | Block storage | NFS protocol |
| **Scalability** | Manual scaling | Automatic scaling |
| **Availability** | Single AZ | Multi-AZ |
| **Use Case** | Boot volumes, databases | Shared content, web serving |
| **Performance** | Higher IOPS | Network-dependent |

### 3. Explain EFS performance modes.
**Answer:**
- **General Purpose**: Default mode, lowest latency per operation, up to 7,000 file operations per second
- **Max I/O**: Higher performance, can scale to higher levels of aggregate throughput and operations per second (10,000+), but with slightly higher latency

### 4. What are EFS throughput modes?
**Answer:**
- **Bursting**: Default mode, throughput scales with file system size. Baseline of 50 MiB/s per TiB stored, can burst to 100 MiB/s
- **Provisioned**: Fixed throughput regardless of storage size, pay for provisioned throughput separately

### 5. How do you mount EFS on EC2 instances?
**Answer:**
```bash
# Install EFS utils
sudo yum install -y amazon-efs-utils

# Create mount point
sudo mkdir /mnt/efs

# Mount using EFS helper
sudo mount -t efs fs-xxxxxxxxx:/ /mnt/efs

# Or using traditional NFS
sudo mount -t nfs4 fs-xxxxxxxxx.efs.region.amazonaws.com:/ /mnt/efs
```

## Intermediate Level Questions

### 6. What are EFS Access Points and why would you use them?
**Answer:**
Access Points are application-specific entry points into EFS that enforce:
- **Root directory**: Specific path in the file system
- **POSIX permissions**: User ID, Group ID, and file permissions
- **Use cases**: Multi-tenant applications, enforcing directory structure, access control

Example configuration:
```
Root path: /app1/data
POSIX user: UID 1001, GID 1001
Directory permissions: 0755
```

### 7. How do you secure EFS file systems?
**Answer:**
Multiple security layers:
- **Security Groups**: Control NFS traffic (port 2049)
- **IAM policies**: Control API access to EFS
- **File system policies**: Resource-based policies for EFS access
- **Access Points**: POSIX-level access control
- **Encryption**: At rest and in transit
- **VPC**: Network isolation

### 8. Explain EFS encryption options.
**Answer:**
- **Encryption at Rest**: 
  - Must be enabled during creation
  - Uses AWS KMS keys
  - Cannot be disabled after creation
- **Encryption in Transit**:
  - Can be enabled anytime
  - Uses TLS 1.2
  - Mount with `-o tls` option

### 9. What is EFS Intelligent Tiering?
**Answer:**
Automatic cost optimization feature that:
- Monitors access patterns
- Moves files not accessed for 30 days to Infrequent Access (IA) class
- Automatically moves files back to Standard when accessed
- Can reduce costs by up to 92% for infrequently accessed files
- Transparent to applications

### 10. How do you backup EFS file systems?
**Answer:**
Two backup options:
- **AWS Backup**: 
  - Automatic backups with lifecycle policies
  - Point-in-time recovery
  - Cross-region backup support
- **EFS-to-EFS Backup**:
  - Creates another EFS as backup destination
  - Incremental backups
  - Custom scripts or AWS DataSync

## Advanced Level Questions

### 11. You have a web application with multiple EC2 instances across different AZs. How would you design EFS architecture for high availability?
**Answer:**
```
Architecture Design:
1. Create EFS with Regional storage class
2. Create mount targets in each AZ where EC2 instances exist
3. Use separate security groups for mount targets and EC2 instances
4. Configure Auto Scaling Group across multiple AZs
5. Use Application Load Balancer for traffic distribution
6. Enable EFS Intelligent Tiering for cost optimization
7. Set up CloudWatch monitoring and alarms
8. Configure automatic backups

Security considerations:
- Dedicated security group for EFS mount targets
- IAM roles for EC2 instances with minimal EFS permissions
- Enable encryption in transit and at rest
```

### 12. How would you troubleshoot EFS mount issues?
**Answer:**
**Systematic troubleshooting approach:**

1. **Network Connectivity**:
```bash
# Test NFS port connectivity
telnet fs-xxxxxxxxx.efs.region.amazonaws.com 2049
nc -zv fs-xxxxxxxxx.efs.region.amazonaws.com 2049
```

2. **DNS Resolution**:
```bash
nslookup fs-xxxxxxxxx.efs.region.amazonaws.com
dig fs-xxxxxxxxx.efs.region.amazonaws.com
```

3. **Security Groups**:
```bash
# Check if NFS (2049) is allowed from EC2 to EFS mount targets
# Verify both inbound and outbound rules
```

4. **EFS Utils Installation**:
```bash
rpm -qa | grep amazon-efs-utils
yum list installed | grep efs
```

5. **Mount Command Debugging**:
```bash
# Enable debug logging
echo 'net 30 30 30 30' > /proc/sys/sunrpc/rpc_debug
mount -t efs -o _netdev,tls,regional fs-xxxxxxxxx:/ /mnt/efs
```

### 13. Explain EFS performance optimization strategies.
**Answer:**
**Performance Optimization Techniques:**

1. **Choose Right Performance Mode**:
   - General Purpose: <7,000 ops/sec, lower latency
   - Max I/O: >7,000 ops/sec, higher latency

2. **Optimize Throughput Mode**:
   - Bursting: Good for variable workloads
   - Provisioned: Consistent high throughput needs

3. **Network Optimization**:
```bash
# Use multiple connections
mount -t efs -o nfsvers=4.1,rsize=1048576,wsize=1048576 fs-xxx:/ /mnt/efs

# Enable fscache for read performance
mount -t efs -o fsc fs-xxx:/ /mnt/efs
```

4. **Application-Level Optimizations**:
   - Use larger I/O sizes
   - Implement multithreading for concurrent access
   - Use local caching where appropriate

5. **Monitor Performance**:
```bash
# Key CloudWatch metrics to monitor
- TotalIOTime
- DataReadIOBytes
- DataWriteIOBytes
- PercentIOLimit
```

### 14. How would you migrate data to EFS?
**Answer:**
**Migration Strategies:**

1. **AWS DataSync** (Recommended):
```bash
# Create DataSync task
aws datasync create-task \
  --source-location-arn arn:aws:datasync:region:account:location/loc-xxx \
  --destination-location-arn arn:aws:datasync:region:account:location/loc-yyy \
  --name "OnPremToEFS"
```

2. **EFS Utils with rsync**:
```bash
# Install EFS utils and mount
sudo yum install -y amazon-efs-utils
sudo mount -t efs fs-xxx:/ /mnt/efs

# Sync data
rsync -avz --progress /source/path/ /mnt/efs/
```

3. **AWS Storage Gateway**:
   - For hybrid scenarios
   - File Gateway provides NFS interface to S3
   - Can then copy from S3 to EFS using DataSync

4. **Considerations**:
   - Bandwidth limitations
   - Metadata preservation
   - Incremental sync capabilities
   - Downtime requirements

### 15. Design a disaster recovery solution using EFS.
**Answer:**
**DR Architecture:**

1. **Multi-Region Setup**:
```
Primary Region (us-east-1):
- EFS with automatic backups
- EC2 instances with applications
- Regular snapshots to S3

DR Region (us-west-2):
- EFS file system (standby)
- AMIs ready for quick deployment
- DataSync for replication
```

2. **Implementation**:
```bash
# Set up cross-region replication with DataSync
aws datasync create-task \
  --source-location-arn arn:aws:datasync:us-east-1:account:location/primary-efs \
  --destination-location-arn arn:aws:datasync:us-west-2:account:location/dr-efs \
  --schedule "cron(0 */6 * * ? *)"  # Every 6 hours
```

3. **Recovery Process**:
   - Launch EC2 instances in DR region
   - Mount DR EFS file system
   - Update DNS/load balancer to point to DR region
   - Monitor and validate application functionality

4. **Testing**:
   - Regular DR drills
   - Automated testing scripts
   - RTO/RPO measurement and optimization

## Scenario-Based Questions

### 16. Your application is experiencing slow EFS performance. How would you diagnose and resolve this?
**Answer:**
**Diagnosis Steps:**

1. **Check CloudWatch Metrics**:
```
Key metrics to examine:
- PercentIOLimit: If near 100%, hitting performance limits
- TotalIOTime: High values indicate I/O bottlenecks
- DataReadIOBytes/DataWriteIOBytes: Understand I/O patterns
```

2. **Performance Mode Analysis**:
```bash
# Check current performance mode
aws efs describe-file-systems --file-system-id fs-xxx

# If General Purpose mode is hitting limits, consider Max I/O
```

3. **Network Analysis**:
```bash
# Test network latency to EFS
ping fs-xxx.efs.region.amazonaws.com

# Check mount options
mount | grep efs
```

**Resolution Strategies:**
- Switch to Max I/O mode if hitting operation limits
- Use Provisioned throughput for consistent performance
- Optimize mount options (rsize/wsize)
- Implement application-level caching
- Consider EFS Intelligent Tiering for cost optimization

### 17. You need to share files between containers in ECS. How would you implement this using EFS?
**Answer:**
**ECS + EFS Integration:**

1. **Task Definition Configuration**:
```json
{
  "family": "web-app",
  "volumes": [
    {
      "name": "efs-volume",
      "efsVolumeConfiguration": {
        "fileSystemId": "fs-xxxxxxxxx",
        "transitEncryption": "ENABLED",
        "authorizationConfig": {
          "accessPointId": "fsap-xxxxxxxxx"
        }
      }
    }
  ],
  "containerDefinitions": [
    {
      "name": "web-container",
      "mountPoints": [
        {
          "sourceVolume": "efs-volume",
          "containerPath": "/var/www/uploads"
        }
      ]
    }
  ]
}
```

2. **Service Configuration**:
```bash
# Ensure ECS service runs in subnets with EFS mount targets
# Configure security groups to allow NFS traffic
# Use Fargate or EC2 launch type
```

3. **Benefits**:
   - Persistent storage across container restarts
   - Shared data between multiple containers
   - Automatic scaling with application
   - No data loss during deployments

### 18. How would you implement a multi-tenant application using EFS Access Points?
**Answer:**
**Multi-Tenant Architecture:**

1. **Access Point Strategy**:
```
Tenant A: /tenants/tenant-a (UID: 1001, GID: 1001)
Tenant B: /tenants/tenant-b (UID: 1002, GID: 1002)
Tenant C: /tenants/tenant-c (UID: 1003, GID: 1003)
```

2. **Implementation**:
```bash
# Create access points for each tenant
aws efs create-access-point \
  --file-system-id fs-xxx \
  --posix-user Uid=1001,Gid=1001 \
  --root-directory Path=/tenants/tenant-a,CreationInfo='{OwnerUid=1001,OwnerGid=1001,Permissions=0755}'
```

3. **Application Integration**:
```python
# Python example - dynamic mounting based on tenant
def mount_tenant_storage(tenant_id):
    access_point_id = get_access_point_for_tenant(tenant_id)
    mount_command = f"mount -t efs -o accesspoint={access_point_id} fs-xxx:/ /app/data/{tenant_id}"
    subprocess.run(mount_command, shell=True)
```

4. **Security Benefits**:
   - Tenant isolation at file system level
   - POSIX permissions enforcement
   - Path restriction per access point
   - Simplified access management

## Cost Optimization Questions

### 19. How would you optimize EFS costs for a large-scale application?
**Answer:**
**Cost Optimization Strategies:**

1. **Storage Classes**:
```
Standard: Frequently accessed files
IA (Infrequent Access): Files accessed <30 days, 92% cost reduction
```

2. **Intelligent Tiering**:
```bash
# Enable Intelligent Tiering
aws efs put-lifecycle-configuration \
  --file-system-id fs-xxx \
  --lifecycle-policies TransitionToIA=AFTER_30_DAYS
```

3. **Throughput Optimization**:
```
Bursting Mode: Pay for storage only
Provisioned Mode: Pay for storage + provisioned throughput
Choose based on usage patterns
```

4. **Data Lifecycle Management**:
```bash
# Implement data archival policies
# Move old data to S3 Glacier
# Use AWS DataSync for automated archival
```

5. **Monitoring and Alerts**:
```bash
# Set up cost monitoring
aws cloudwatch put-metric-alarm \
  --alarm-name "EFS-High-Cost" \
  --metric-name EstimatedCharges \
  --threshold 1000
```

### 20. Explain the pricing model for EFS and how to estimate costs.
**Answer:**
**EFS Pricing Components:**

1. **Storage Pricing**:
```
Standard Storage: $0.30 per GB-month
IA Storage: $0.025 per GB-month (92% savings)
```

2. **Throughput Pricing** (Provisioned mode only):
```
$6.00 per MiB/s-month of provisioned throughput
```

3. **Request Pricing** (IA storage):
```
$0.01 per GB of data retrieved
```

**Cost Estimation Example**:
```
Scenario: 1 TB storage, 70% Standard, 30% IA
Standard: 700 GB × $0.30 = $210/month
IA: 300 GB × $0.025 = $7.5/month
Total: $217.5/month

With all Standard: 1000 GB × $0.30 = $300/month
Savings: $82.5/month (27.5%)
```

**Cost Optimization Calculator**:
```python
def calculate_efs_cost(standard_gb, ia_gb, provisioned_throughput=0):
    standard_cost = standard_gb * 0.30
    ia_cost = ia_gb * 0.025
    throughput_cost = provisioned_throughput * 6.00
    
    total_cost = standard_cost + ia_cost + throughput_cost
    return {
        'standard_storage': standard_cost,
        'ia_storage': ia_cost,
        'throughput': throughput_cost,
        'total_monthly': total_cost
    }
```

These interview questions cover the complete spectrum of EFS knowledge from basic concepts to advanced implementation scenarios, providing a thorough preparation for EFS-related interviews.