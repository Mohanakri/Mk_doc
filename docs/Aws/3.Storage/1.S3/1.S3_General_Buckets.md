# Amazon S3 and Glacier - AWS Study Notes

## Overview

Amazon S3 (Simple Storage Service) is object storage designed to store and retrieve any amount of data from anywhere on the Internet.

### Key Characteristics
- **Storage Type**: Object storage with simple key-based system
- **Scalability**: Infinitely scalable data storage infrastructure
- **Durability**: Extremely durable and highly available
- **Architecture**: Distributed with redundant storage across multiple devices and facilities (AZs)
- **Interface**: Simple, standards-based REST web services interface
- **Access**: Recommended to use SDKs and APIs (console uses APIs)

### Object Specifications
- **File Size Range**: 0 bytes to 5TB
- **Single PUT Limit**: Maximum 5GB per single PUT operation
- **Large Object Upload**: Use Multipart Upload for objects >100MB
- **Storage Limit**: Unlimited storage available
- **Atomic Updates**: Either get new object or old one, never partial/corrupt data
- **Consistency**: Read-after-write consistency for new object PUTs, eventual consistency for overwrites and deletes

### S3 Data Components
- **Key**: Object name/identifier
- **Value**: The actual data
- **Version ID**: For versioned objects
- **Metadata**: Information about the object
- **Access Control Lists**: Permissions for the object

---

## Additional Capabilities

| Capability | Description |
|------------|-------------|
| **Transfer Acceleration** | Speeds up uploads using CloudFront in reverse |
| **Requester Pays** | Requester pays for requests and data transfer instead of bucket owner |
| **Tags** | Assign tags to objects for hosting, billing, security, etc. |
| **Events** | Trigger notifications to SNS, SQS, or Lambda for bucket events |
| **Static Web Hosting** | Simple and massively scalable static web hosting |
| **BitTorrent** | Retrieve publicly available objects using BitTorrent protocol |
| **Storage Class Analysis** | Analyze access patterns to optimize storage class transitions |
| **Storage Lens** | Organization-wide visibility into storage usage and optimization recommendations |
| **S3 Object Lambda** | Add custom code to S3 GET requests to modify data as returned |

---

## Use Cases

### Primary Use Cases
- **Backup and Storage**: Data backup and storage services
- **Application Hosting**: Deploy, install, and manage web applications
- **Media Hosting**: Redundant, scalable infrastructure for video, photo, music
- **Software Delivery**: Host software applications for customer downloads
- **Static Websites**: Configure static website hosting from S3 bucket

### Storage Classification
| Storage Type | Description | AWS Examples |
|-------------|-------------|--------------|
| **Persistent** | Data survives reboots, restarts, power cycles | S3, Glacier, EBS, EFS |
| **Transient** | Data temporarily stored and passed to another process | SQS, SNS |
| **Ephemeral** | Data lost when system stopped | EC2 Instance Store, Memcached |

---

## Buckets

### Bucket Fundamentals
- **Structure**: Flat container of objects (no hierarchy)
- **Folder Simulation**: Use object key names (prefixes) to mimic folders
- **Limits**: 100 buckets per account by default
- **Objects**: Unlimited objects per bucket
- **Console Folders**: Can create folders through console only
- **Nesting**: Cannot create nested buckets
- **Ownership**: Not transferable between accounts
- **Names**: Cannot be changed after creation

### Bucket Naming Rules
- **Length**: 3-63 characters
- **Start/End**: Must begin and end with lowercase letter or number
- **Characters**: Lowercase letters, numbers, hyphens, periods (as separators)
- **Format**: Cannot be formatted as IP address
- **Global Namespace**: Names must be unique globally

### Bucket Characteristics
- **Regional**: Buckets are region-specific
- **URL Format**: `https://s3-<region>.amazonaws.com/<bucketname>`
- **Performance**: Create buckets closer to clients for better performance
- **Backup**: Can backup to another bucket in different account
- **Logging**: Can enable access logging

---

## Objects

### Object Identification
Each object is uniquely identified by:
- Service endpoint
- Bucket name
- Object key (name)
- Optional object version

### Object Properties
- **Regional Persistence**: Objects never leave their region unless explicitly moved
- **Permissions**: Can define permissions during upload and modify anytime
- **Unique Keys**: Each object retrieved by unique key (ID or name)

### Performance Characteristics
Amazon S3 automatically scales to high request rates:
- **PUT/POST/DELETE**: At least 3,500 requests per second per prefix
- **GET**: 5,500 requests per second per prefix
- **Prefixes**: No limits to number of prefixes in bucket
- **CloudFront**: Use for read-intensive requests to offload from S3

---

## Subresources

### Bucket-Associated Subresources
- **Lifecycle**: Define object lifecycle management
- **Website**: Configuration for static website hosting
- **Versioning**: Retain multiple versions of objects
- **Access Control Lists (ACLs)**: Control bucket permissions
- **Bucket Policies**: Control access to bucket
- **CORS**: Cross-Origin Resource Sharing configuration
- **Logging**: Access logging configuration

### Object-Associated Subresources
- **ACLs**: Define object access permissions
- **Restore**: Restore archived objects

---

## Cross-Origin Resource Sharing (CORS)

### Purpose
- Allow requests to different origin when connected to main origin
- Request fails unless origin allows requests using CORS headers

### Configuration
- Must enable correct CORS headers
- Specify CORS configuration on S3 bucket
- Example header: `Access-Control-Allow-Origin`

---

## Storage Classes

### Available Storage Classes
1. **S3 Standard**: Durable, immediately available, frequently accessed
2. **S3 Intelligent-Tiering**: Automatically moves data to most cost-effective tier
3. **S3 Standard-IA**: Durable, immediately available, infrequently accessed
4. **S3 One Zone-IA**: Lower cost for infrequently accessed data with less resilience
5. **S3 Glacier Instant Retrieval**: Archived data with millisecond retrieval
6. **S3 Glacier Flexible Retrieval**: Archived data, retrieval in minutes or hours
7. **S3 Glacier Deep Archive**: Lowest cost for long-term retention

### Storage Class Comparison

| Class | Durability | Availability | AZs | Min Size | Min Duration | Retrieval | Latency |
|-------|------------|-------------|-----|----------|--------------|-----------|---------|
| **Standard** | 11 9's | 99.99% | ≥3 | N/A | N/A | N/A | ms |
| **Intelligent-Tiering** | 11 9's | 99.9% | ≥3 | N/A | N/A | N/A | ms |
| **Standard-IA** | 11 9's | 99.9% | ≥3 | 128 KB | 30 days | per GB | ms |
| **One Zone-IA** | 11 9's | 99.5% | 1 | 128 KB | 30 days | per GB | ms |
| **Glacier Instant** | 11 9's | 99.9% | ≥3 | 128 KB | 90 days | per GB | ms |
| **Glacier Flexible** | 11 9's | 99.99% | ≥3 | 40 KB | 90 days | per GB | min-hours |
| **Glacier Deep Archive** | 11 9's | 99.99% | ≥3 | 40 KB | 180 days | per GB | hours |

---

## Access Control and Policies

### Access Control Mechanisms
1. **IAM Policies**: User and role-based permissions
2. **Bucket Policies**: Resource-based bucket access control
3. **Access Control Lists (ACLs)**: Object-level permissions
4. **Query String Authentication**: Time-limited URL access

### Default Access Behavior
- **Default State**: Buckets, objects, and subresources are private
- **Resource Owner**: AWS account that creates the resource
- **IAM Users**: Account owner (not IAM user) is the resource owner

### Amazon Resource Names (ARNs)
**Format**: `arn:partition:service:region:namespace:relative-id`

**S3 ARN Examples**:
- Bucket: `arn:aws:s3:::bucket_name`
- Object: `arn:aws:s3:::bucket_name/key_name`

### Access Policy Types

#### Resource-Based Policies
- **ACLs**: Grant read/write permissions to other accounts
- **Bucket Policies**: Grant permissions to AWS accounts or IAM users
- **Scope**: Up to 20 KB in size for bucket policies
- **Object ACLs**: Limited to 100 granted permissions per ACL

#### User Policies
- **IAM Integration**: Create users, groups, roles with attached policies
- **Scope**: Cannot grant anonymous permissions
- **Permissions**: Can grant permissions to bucket and objects

### Pre-defined Groups

#### Authenticated Users Group
- **Scope**: Represents all AWS accounts
- **Access**: Allows any AWS account access to resource
- **Requirement**: All requests must be signed (authenticated)

#### All Users Group
- **Scope**: Anyone in the world
- **Access**: Requests can be signed or unsigned (anonymous)
- **Recommendation**: Never grant WRITE, WRITE_ACP, or FULL_CONTROL

#### Log Delivery Group
- **Purpose**: Enable S3 to write server access logs
- **Requirement**: Provide WRITE permission to bucket

### ACL Permissions

| Permission | Bucket Level | Object Level |
|------------|-------------|-------------|
| **READ** | List objects in bucket | Read object data and metadata |
| **WRITE** | Create, overwrite, delete objects | N/A |
| **READ_ACP** | Read bucket ACL | Read object ACL |
| **WRITE_ACP** | Write bucket ACL | Write object ACL |
| **FULL_CONTROL** | All bucket permissions | All object permissions |

### Cross-Account Access
- **Owner**: Account that uploads objects owns them
- **Bucket Owner**: Pays charges but may not have object permissions
- **Permissions**: Bucket owner can deny access to any objects
- **Operations**: Bucket owner can archive/restore any objects regardless of ownership

---

## Charges and Pricing

### Free Services
- Data transfer between EC2 and S3 in same region
- Data transfer into S3

### Chargeable Services
- **Storage**: Per GB/month storage fee
- **Data Transfer**: Data transferred to other regions
- **Requests**: Upload requests (PUT) and retrieval requests (GET)
- **Retrieval**: For IA and Glacier storage classes

### Requester Pays
- **Bucket Owner**: Pays only for object storage
- **Requester**: Pays for requests and data transfers
- **Scope**: Can only be enabled at bucket level
- **Access**: Removes anonymous access

---

## Multipart Upload

### Purpose
- Speed up uploads to S3
- Upload objects in parts independently, in parallel, any order

### Specifications
- **Recommended**: Objects ≥100MB
- **Range**: Can be used for objects 5MB - 5TB
- **Required**: Must be used for objects >5GB
- **API**: Uses S3 Multipart Upload API

### Benefits
- **Fault Tolerance**: Retransmit only failed parts
- **Throughput**: Improved throughput
- **Flexibility**: Pause and resume uploads
- **Preemptive**: Begin upload before knowing final object size

---

## S3 Copy Operations

### Capabilities
- **Single Operation**: Copy objects up to 5GB in single atomic operation
- **Large Files**: Use multipart upload API for files >5GB
- **Methods**: AWS SDKs or REST API

### Use Cases
- Generate additional copies of objects
- Rename objects
- Change storage class or encryption status
- Move objects across AWS locations/regions
- Change object metadata

---

## Transfer Acceleration

### Overview
- **Purpose**: Fast, secure transfers over long distances
- **Technology**: Leverages Amazon CloudFront's globally distributed Edge Locations
- **Security**: As secure as direct upload to S3

### Configuration
- **Enablement**: Must enable on S3 bucket
- **Status**: Cannot be disabled, only suspended
- **Implementation Time**: Up to 30 minutes
- **URL Format**: `<bucketname>.s3-accelerate.amazonaws.com`

### Requirements
- **Bucket Names**: Must be DNS compliant, no periods between labels
- **Endpoints**: Use `.s3-accelerate.amazonaws.com` or `.s3-accelerate.dualstack.amazonaws.com`
- **Compatibility**: Supports all bucket-level features including multipart uploads
- **Compliance**: HIPAA compliant

### Pricing
- Charged only if there was transfer time benefit

---

## Static Website Hosting

### Capabilities
- **Content Type**: Static websites only (no PHP, .Net, etc.)
- **Scaling**: Automatically scales
- **Custom Domain**: Use Route 53 Alias record with custom domain
- **Domain Requirement**: Bucket name must match domain name for custom domains

### Configuration Requirements
- **Index Document**: Default web page (required)
- **Error Document**: Custom error page (optional)
- **Redirects**: Support for object and bucket level redirects

### Endpoint Characteristics
- **URL Format**: `<bucketname>.s3-website-<region>.amazonaws.com`
- **Protocol**: Does not support HTTPS/SSL
- **Response**: Returns HTML documents
- **Requests**: Supports only GET and HEAD requests on objects
- **Access**: Supports publicly readable content only

### REST API vs Website Endpoint Comparison

| Feature | REST API Endpoint | Website Endpoint |
|---------|------------------|------------------|
| **Access Control** | Public and private content | Publicly readable only |
| **Error Handling** | XML-formatted error response | HTML document |
| **Redirection** | Not applicable | Object and bucket level redirects |
| **Request Support** | All bucket and object operations | GET and HEAD requests only |
| **Root Requests** | Returns object key list | Returns index document |
| **SSL Support** | Supports SSL connections | No SSL support |

### Limitations
- **Requester Pays**: Does not work with website endpoints
- **Dynamic Content**: Cannot serve dynamic content

---

## Pre-Signed URLs

### Purpose
- Provide temporary access to specific objects
- Allow access for users without AWS credentials

### Characteristics
- **Default Access**: All objects are private by default
- **Sharing Options**: Make public or generate pre-signed URL
- **Expiration**: Must configure expiration date and time
- **Generation**: Use SDKs for Java/.Net or AWS Explorer for Visual Studio
- **Operations**: Support both downloading and uploading S3 objects

---

## Versioning

### Overview
- **Function**: Stores all versions of an object including all writes and deletes
- **Protection**: Guards against accidental deletion or overwrites
- **Capabilities**: Enables rollback and un-delete functionality

### Key Characteristics
- **Billing**: Old versions count as billable size until permanently deleted
- **Existing Objects**: Enabling versioning does not replicate existing objects
- **State Management**: Once enabled, cannot be disabled, only suspended
- **Integration**: Can be integrated with lifecycle rules
- **MFA Delete**: Multi-factor authentication can be enabled for deletion

### Version Management
- **Default Retrieval**: HTTP GET retrieves most recent version
- **Delete Behavior**: DELETE adds a delete marker instead of removing object
- **Permanent Deletion**: Only bucket owner can permanently delete once versioning enabled
- **Delete Marker**: Can be removed to restore object availability

### Versioning States
- **Enabled**: Active versioning
- **Versioned**: Has versioning history
- **Un-versioned**: Never had versioning enabled

### Suspension Behavior
- **Existing Objects**: Remain unchanged during suspension
- **New Objects**: Get version ID of NULL during suspension
- **Same Name Uploads**: Overwrite existing object during suspension

### Cross Region Replication Requirements
- **Requirement**: Versioning must be enabled on source and destination buckets
- **Replication**: Delete markers replicate, but deleting delete markers does not

---

## Object Lifecycle Management

### Purpose
- **Cost Optimization**: Optimize storage costs
- **Data Retention**: Adhere to data retention policies
- **Maintenance**: Keep S3 volumes well-maintained

### Configuration
- **Level**: Applied at bucket level as subresource
- **Format**: XML file configuration
- **Usage**: Can be used with or without versioning
- **Scope**: Apply to current and previous versions
- **Targeting**: Specific objects by tag or prefix

### Lifecycle Actions

#### Transition Actions
- **Purpose**: Define when objects transition to another storage class
- **Cost**: Lifecycle transition requests have associated costs
- **Example**: Transition to STANDARD_IA after 30 days, GLACIER after 1 year

#### Expiration Actions
- **Purpose**: Define when objects expire
- **Behavior**: Amazon S3 deletes expired objects automatically

### Supported Transitions
- **FROM Standard**: Can transition to any other storage class
- **TO Glacier/Deep Archive**: Can transition from any storage class
- **FROM Standard-IA**: Can transition to Intelligent-Tiering or One Zone-IA
- **FROM Intelligent-Tiering**: Can transition to One Zone-IA
- **FROM Glacier**: Can transition to Deep Archive only

### Unsupported Transitions
- **TO Standard**: Cannot transition from any class to Standard
- **TO Reduced Redundancy**: Cannot transition to Reduced Redundancy
- **FROM Intelligent-Tiering**: Cannot transition to Standard-IA
- **FROM One Zone-IA**: Cannot transition to Standard-IA or Intelligent-Tiering
- **FROM Deep Archive**: Cannot transition to any other class

### Transition Constraints

#### Size Constraints
- **Intelligent-Tiering**: Objects <128KB not transitioned (not cost effective)
- **Standard-IA/One Zone-IA**: Objects <128KB not transitioned (not cost effective)

#### Time Constraints
- **30-Day Rule**: Objects must be stored 30 days before transitioning to Standard-IA or One Zone-IA
- **Noncurrent Objects**: Must be 30 days noncurrent before transitioning to IA classes
- **Standard-IA to One Zone-IA**: Must be stored 30 days in Standard-IA first

---

## Encryption

### Encryption in Transit
- **Protocol**: Securely upload/download via SSL endpoints using HTTPS
- **Method**: SSL/TLS encryption

### Server-Side Encryption Options

| Option | Description | Key Management |
|--------|-------------|----------------|
| **SSE-S3** | S3 managed keys with AES-256 | AWS managed |
| **SSE-C** | Customer provided AES-256 keys | Customer managed |
| **SSE-KMS** | AWS KMS managed keys | AWS KMS |
| **Client Side** | Client encrypts before upload | Customer managed |

### SSE-S3 (Server-Side Encryption with S3 Managed Keys)
- **Encryption**: Each object encrypted with unique key
- **Key Protection**: Encryption key encrypted with master key  
- **Key Rotation**: AWS regularly rotates master key
- **Algorithm**: AES-256

### SSE-KMS (Server-Side Encryption with KMS Keys)
- **Keys**: Uses Customer Master Keys (CMKs)
- **Options**: Use auto-created CMK or select your own key
- **Protection**: Envelope key protects your keys
- **Benefits**: Additional permissions control, audit trail
- **Cost**: Chargeable service
- **Permissions**: Requires kms:Decrypt, kms:ReEncrypt, kms:GenerateDataKey, kms:DescribeKey

### SSE-C (Server-Side Encryption with Customer-Provided Keys)
- **Management**: Customer manages keys, S3 manages encryption
- **Storage**: AWS does not store encryption keys
- **Risk**: If keys are lost, data cannot be decrypted

#### Required Headers for SSE-C
- `x-amz-server-side-encryption-customer-algorithm`: Must be "AES256"
- `x-amz-server-side-encryption-customer-key`: 256-bit, base64-encoded encryption key
- `x-amz-server-side-encryption-customer-key-MD5`: Base64-encoded 128-bit MD5 digest

### Client-Side Encryption
- **Process**: Encrypt data before sending to S3
- **Options**: Use AWS KMS CMK or customer master key

#### Option 1: AWS KMS CMK
- **Upload**: Client requests CMK from KMS, encrypts object data
- **Download**: Client downloads cipher blob, requests plaintext key from KMS

#### Option 2: Customer Master Key
- **Upload**: Client generates data key, encrypts with master key
- **Download**: Client uses master key to decrypt data key, then decrypts object

### Bucket Policy for Encryption
- Use bucket policy to require server-side encryption for all objects
- Include `x-amz-server-side-encryption` request header

---

## Event Notifications

### Overview
- **Triggers**: Respond to S3 actions like PUTs, POSTs, COPYs, DELETEs
- **Purpose**: Run workflows, send alerts, perform automated actions
- **Filtering**: Configure by prefix and suffix of object key names

### Supported Events
- **Object Creation**: New object created events
- **Object Removal**: Object deletion events
- **Restore Events**: Object restore from Glacier
- **RRS Events**: Reduced Redundancy Storage object lost events
- **Replication Events**: Cross-region replication events

### Notification Destinations
- **Amazon SNS**: Publish messages to SNS topic
- **Amazon SQS**: Publish messages to SQS queue
- **AWS Lambda**: Invoke Lambda function with event message

### Configuration Requirements
- **Permissions**: Grant S3 permissions to post to SNS/SQS or invoke Lambda
- **Pre-configuration**: Configure SNS/SQS/Lambda before S3 notifications
- **Charges**: No extra S3 charges, but pay for SNS/SQS/Lambda usage

---

## Object Tags

### Overview
- **Structure**: Key-value pairs applied to S3 objects
- **Lifecycle**: Can be created, updated, or deleted during object lifetime
- **Limit**: Up to 10 tags per S3 object

### Use Cases
- **IAM Policies**: Create identity and access management policies
- **Lifecycle Policies**: Setup S3 lifecycle policies
- **Storage Metrics**: Customize storage metrics and reporting

### Management Methods
- AWS Management Console
- REST API
- AWS CLI
- AWS SDKs

---

## Amazon S3 CloudWatch Metrics

### Metric Types

#### Request Metrics
- **Granularity**: 1-minute intervals
- **Availability**: Within 15 minutes after enablement
- **Configuration**: Enable via console or PUT Bucket Metrics API
- **Filtering**: Can configure filters using prefix or object tag
- **Billing**: Charged at CloudWatch custom metrics rate

#### Storage Metrics
- **Frequency**: Reported once per day
- **Default**: Enabled by default for all buckets
- **Cost**: No additional charges

### Available Metrics
- **S3 Requests**: Request counts and types
- **Bucket Storage**: Total storage used
- **Bucket Size**: Number of objects
- **All Requests**: Total request metrics
- **HTTP Errors**: 4XX and 5XX error rates

---

## Cross Region Replication (CRR)

### Overview
- **Purpose**: Automatically replicate data across AWS Regions
- **Configuration**: Set up at S3 bucket level
- **Replication**: Asynchronous copying of objects between regions

### Requirements
- **Versioning**: Must be enabled on both source and destination buckets
- **Regions**: Source and destination buckets must be in different regions
- **Relationship**: 1:1 replication (one source to one destination)

### Configuration Options
- **Scope**: Replicate all objects or subset with specific prefixes
- **Storage Class**: Can specify different storage class for replicas
- **Encryption**: Can replicate KMS-encrypted objects with destination KMS key
- **Cross-Account**: Can replicate across AWS accounts

### Replication Triggers
- **Object Upload**: Uploading new objects to source bucket
- **Object Deletion**: DELETE operations in source bucket
- **Object Changes**: Changes to object, metadata, or ACL

### What Gets Replicated
- **New Objects**: Created after enabling replication
- **Object Changes**: Modifications to existing objects
- **SSE-S3 Objects**: Objects encrypted with AWS managed keys
- **ACL Updates**: Access Control List changes

### What Doesn't Get Replicated
- **Existing Objects**: Objects present before enabling replication
- **SSE-C and SSE-KMS**: Objects with customer keys or KMS keys
- **Insufficient Permissions**: Objects bucket owner cannot access
- **Bucket Subresources**: Bucket-level configuration changes
- **Lifecycle Actions**: Actions triggered by lifecycle rules
- **Already Replicated**: Objects replicated from another region

### Deletion Behavior
- **Delete Without Version ID**: Creates and replicates delete marker
- **Delete With Version ID**: Deletes object but doesn't replicate delete marker

### Costs
- **Upload Requests**: Charges for replication requests
- **Inter-Region Transfer**: Data transfer charges between regions
- **Storage**: Storage costs in both regions

### Benefits
- **Latency**: Lower latency access by copying objects closer to users
- **Compliance**: Meet regulatory requirements for data replication
- **Backup**: Cross-region backup and disaster recovery

---

## Same Region Replication (SRR)

### Overview
- **Purpose**: Replicate objects to destination bucket within same region
- **Release**: Feature released September 2018
- **Replication**: Automatic and asynchronous

### Configuration
- **Level**: Bucket, prefix, or object tag levels
- **Ownership**: Objects can be owned by same account or different accounts
- **Storage Classes**: Can replicate to any S3 storage class including Glacier

### Replication Scope
- **Metadata**: Includes metadata, ACLs, and object tags
- **Triggers**: Object changes, metadata updates, ACL changes, tag updates trigger replication

### Use Cases
- **Protection**: Guard against accidental deletion
- **Compliance**: Meet compliance requirements within region
- **Processing**: Create copies for different processing workflows
- **Storage Optimization**: Replicate to different storage classes

---

## S3 Analytics

### Overview
- **Capability**: Run analytics on data stored in S3
- **Data Types**: Data lakes, IoT streaming data, machine learning, AI

### Analytics Strategies

| Strategy | Services Used |
|----------|---------------|
| **Data Lake Concept** | Athena, Redshift Spectrum, QuickSight |
| **IoT Streaming Data** | Kinesis Firehose |
| **ML and AI Storage** | Rekognition, Lex, MXNet |
| **Storage Class Analysis** | S3 Management Analytics |

### Storage Class Analysis
- **Purpose**: Analyze storage access patterns
- **Benefit**: Help decide when to transition data to appropriate storage class
- **Optimization**: Improve cost efficiency based on actual usage patterns

---

## S3 Inventory

### Overview
- **Purpose**: Audit and report on replication and encryption status
- **Compliance**: Support business, compliance, and regulatory needs

### Output Formats
- **CSV**: Comma-separated values
- **ORC**: Apache Optimized Row Columnar
- **Parquet**: Apache Parquet format

### Configuration
- **Frequency**: Daily or weekly basis
- **Scope**: S3 bucket or shared prefix (objects with common name prefix)
- **Content**: Lists objects and corresponding metadata

---

## Monitoring and Reporting

### CloudWatch Integration
- **Daily Storage Metrics**: Monitor bucket storage using CloudWatch
- **Request Metrics**: Monitor S3 requests at 1-minute intervals
- **Replication Metrics**: Monitor replication operations with S3 RTC

#### Daily Storage Metrics
- **Frequency**: Reported once per day
- **Cost**: Provided to all customers at no additional cost
- **Purpose**: Understand storage usage patterns

#### Request Metrics
- **Interval**: Available at 1-minute intervals
- **Latency**: Some processing delay
- **Billing**: Charged at CloudWatch custom metrics rate
- **Use Case**: Quickly identify and act on operational issues

#### Replication Metrics
- **Requirement**: Only available with S3 Replication Time Control (RTC)
- **Metrics**: Pending operations, pending size, maximum replication time

---

## Logging and Auditing

### Logging Options
- **Server Access Logging**: Detailed records of bucket requests
- **AWS CloudTrail**: Log bucket and object-level actions
- **Recommendation**: Use CloudTrail for comprehensive logging

### Server Access Logging
- **Content**: Detailed records of requests made to bucket
- **Purpose**: Auditing and compliance
- **Warning**: Do not set logged bucket as destination (creates logging loop)

### CloudTrail Integration
- **Scope**: Bucket and object-level actions
- **Identity Information**: Captures IAM/user identity in logs
- **Recommendation**: Preferred method for S3 resource logging

---

## S3 Performance Guidelines

### Performance Optimization Strategies

#### Measure Performance
- **Metrics**: Monitor network throughput, CPU, and DRAM requirements
- **Instance Types**: Evaluate different EC2 instance types based on resource mix

#### Scale Connections Horizontally
- **Concurrent Requests**: Issue multiple concurrent requests to S3
- **Separate Connections**: Spread requests across separate connections
- **Bandwidth**: Maximize accessible bandwidth from S3

#### Use Byte-Range Fetches
- **Range Header**: Use Range HTTP header in GET requests
- **Partial Downloads**: Transfer only specified portions of objects
- **Concurrent Connections**: Fetch different byte ranges in parallel
- **Benefits**: Higher aggregate throughput, improved retry times

#### Retry Strategy
- **Aggressive Timeouts**: Use aggressive timeouts and retries for latency-sensitive applications
- **Path Diversity**: Retry requests likely take different paths
- **SDK Configuration**: Configure timeout and retry values in AWS SDKs

#### Regional Optimization
- **Same Region**: Access S3 from EC2 instances in same region
- **Benefits**: Reduced network latency and data transfer costs

#### Transfer Acceleration
- **Use Case**: Minimize latency over long distances
- **Technology**: Leverages CloudFront edge locations
- **Ideal For**: Transferring gigabytes to terabytes across continents

---

## Glacier

### Overview
- **Purpose**: Archiving storage solution for infrequently accessed data
- **Cost**: Extremely low-cost storage option
- **Use Case**: Long-term backup and archive

### Glacier Storage Tiers

#### S3 Glacier Instant Retrieval
- **Retrieval**: Data retrieval in milliseconds
- **Performance**: Same performance as S3 Standard
- **Durability**: 99.999999999% (11 9's) across multiple AZs
- **Availability**: 99.9% data availability per year
- **Minimum Size**: 128KB minimum object size
- **API**: S3 PUT API for direct uploads

#### S3 Glacier Flexible Retrieval (Formerly S3 Glacier)
- **Durability**: 99.999999999% (11 9's) across multiple AZs
- **Retrieval**: Configurable retrieval times from minutes to hours
- **Use Case**: Backup and disaster recovery
- **Cost**: Free bulk retrievals available
- **API**: S3 PUT API for direct uploads

#### S3 Glacier Deep Archive
- **Cost**: Lowest cost storage class
- **Purpose**: Long-term retention (7-10 years)
- **Alternative**: Ideal replacement for magnetic tape libraries
- **Retrieval**: Within 12 hours
- **Durability**: 99.999999999% (11 9's) across multiple AZs

### Glacier Characteristics
- **Real-time Access**: Archived objects not available for real-time access
- **Retrieval Process**: Must submit retrieval request and wait for job completion
- **Temporary Storage**: Retrieved data copied to S3 One Zone-IA
- **Access Window**: 24 hours to download after retrieval
- **Storage Class**: Cannot specify Glacier at object creation time
- **Fault Tolerance**: Designed to sustain loss of two facilities
- **Encryption**: Automatically encrypts data at rest using AES-256
- **Regional Availability**: May not be available in all AWS regions

### Object Management
- **Visibility**: Glacier objects visible through S3 only (not directly through Glacier)
- **Metadata**: Does not archive object metadata (maintain client-side database)
- **Size Range**: Archives can be 1 byte up to 40TB
- **Single Operation**: 1 byte - 4GB can be uploaded in single operation
- **Multipart Upload**: 100MB - 40TB requires multipart upload API
- **Upload**: Synchronous operation
- **Download**: Asynchronous operation
- **Modification**: Archive contents cannot be modified after upload

### Archive Management
- **Console**: Cannot upload to Glacier using AWS Console
- **Upload Methods**: Use CLI, SDKs, or APIs
- **Metadata Overhead**: Glacier adds 32-40KB (indexing and archive metadata) per object
- **Small Objects**: AWS recommends combining small objects in archive (e.g., zip file)
- **Descriptions**: Can add description to archives, no other metadata allowed
- **Archive IDs**: Unique IDs added upon upload for each upload

### Archive Retrieval Options
- **Expedited**: 1-5 minutes retrieval (most expensive)
- **Standard**: 3-5 hours retrieval (cheaper, 10GB free per month)
- **Bulk**: 5-12 hours retrieval (cheapest, for large quantities)

### Retrieval Process
- **Partial Retrieval**: Can retrieve parts of an archive
- **Storage Class**: Retrieved data copied to S3, archive remains in Glacier
- **Notifications**: AWS SNS can send notifications when retrieval jobs complete
- **Access Duration**: Retrieved data available for 24 hours by default (configurable)
- **Byte Range**: Can specify byte range in HTTP GET request for specific objects

### Glacier Charges
- **Free Transfer**: No charge for data transfer between EC2 and Glacier in same region
- **Early Deletion**: Charge applies if data deleted within 90 days (Flexible Retrieval)
- **Restoration Costs**: Pay for Glacier archive, requests, and restored data on S3

---

## Event Notifications Configuration

### Notification Setup
- **Prerequisites**: Configure SNS/SQS/Lambda before S3 configuration
- **Permissions**: Must grant S3 permissions to access destination services
- **Filtering**: Can filter notifications by object key prefix and suffix

### Event Types
- **Object Created**: PUT, POST, COPY operations
- **Object Deleted**: DELETE operations
- **Object Restore**: Glacier restore operations
- **RRS Object Lost**: Reduced Redundancy Storage failures
- **Replication**: Cross-region replication events

---

## Data Consistency Model

### Consistency Types
- **Read-After-Write**: Immediate consistency for new object PUTs
- **Eventual Consistency**: For overwrite PUTs and DELETEs
- **Success Indicator**: HTTP 200 code indicates successful write

### Performance Scaling
- **Automatic Scaling**: S3 automatically scales to high request rates
- **Request Rates**: 3,500 PUT/POST/DELETE and 5,500 GET requests per second per prefix
- **Prefix Limits**: No limits on number of prefixes in bucket
- **CloudFront**: Use CloudFront for read-intensive workloads to offload S3

---

## Security Best Practices

### Access Control Best Practices
- **Principle of Least Privilege**: Grant minimum necessary permissions
- **Resource-Based vs User-Based**: Choose appropriate policy type
- **Cross-Account Access**: Use bucket policies for cross-account permissions
- **Monitoring**: Enable CloudTrail for access auditing

### Encryption Best Practices
- **In Transit**: Always use HTTPS for data transfer
- **At Rest**: Choose appropriate server-side encryption option
- **Key Management**: Consider using AWS KMS for centralized key management
- **Client-Side**: Consider client-side encryption for sensitive data

---

## Cost Optimization Strategies

### Storage Class Optimization
- **Analyze Access Patterns**: Use S3 Storage Class Analysis
- **Lifecycle Policies**: Implement lifecycle rules for automatic transitions
- **Intelligent Tiering**: Consider for unpredictable access patterns

### Request Optimization
- **Batch Operations**: Use S3 Batch Operations for large-scale operations
- **Multipart Upload**: Use for large files to improve efficiency
- **Transfer Acceleration**: Use for long-distance transfers when beneficial

### Monitoring and Analysis
- **CloudWatch Metrics**: Monitor storage metrics and request patterns
- **Storage Lens**: Use for organization-wide visibility and recommendations
- **Cost Allocation Tags**: Implement tagging strategy for cost tracking

---

## Disaster Recovery and Business Continuity

### Backup Strategies
- **Cross-Region Replication**: Automatic replication to different regions
- **Same-Region Replication**: Protection within same region
- **Versioning**: Enable versioning for data protection
- **MFA Delete**: Add extra security for critical data

### Recovery Planning
- **RTO/RPO Requirements**: Define recovery time and point objectives
- **Testing**: Regularly test backup and recovery procedures
- **Documentation**: Maintain current disaster recovery procedures

---

## Integration with Other AWS Services

### Compute Integration
- **EC2**: Mount S3 as data source for EC2 instances
- **Lambda**: Trigger Lambda functions on S3 events
- **ECS/EKS**: Use S3 for container storage needs

### Analytics Integration
- **Athena**: Query S3 data directly using SQL
- **EMR**: Process large datasets stored in S3
- **Redshift**: Load data from S3 into Redshift for analytics

### Data Pipeline Integration
- **Data Pipeline**: Orchestrate data movement to/from S3
- **Glue**: ETL operations on S3 data
- **Kinesis**: Stream data to S3 for processing

---

## Exam Focus Areas

### Key Concepts for AWS Certification
- **Storage Classes**: Understand characteristics and use cases for each storage class
- **Lifecycle Management**: Know transition rules and constraints
- **Security Models**: Understand differences between IAM policies, bucket policies, and ACLs
- **Encryption Options**: Know when to use SSE-S3, SSE-KMS, SSE-C, and client-side encryption
- **Versioning**: Understand versioning behavior and integration with other features
- **Cross-Region Replication**: Requirements, limitations, and use cases
- **Performance**: Understand request patterns and optimization strategies
- **Glacier**: Know different Glacier tiers and retrieval options

### Common Exam Scenarios
- **Access Control**: Troubleshooting access issues using appropriate policy type
- **Cost Optimization**: Choosing right storage class and implementing lifecycle policies
- **Data Protection**: Implementing appropriate backup and recovery strategies
- **Performance Optimization**: Addressing high request rate scenarios
- **Compliance**: Meeting data retention and security requirements
- **Integration**: Understanding how S3 integrates with other AWS services

### Important Limits and Constraints
- **Object Size**: 0 bytes to 5TB per object
- **Single PUT**: Maximum 5GB per PUT operation
- **Bucket Limits**: 100 buckets per account by default
- **Bucket Policy Size**: Maximum 20KB
- **Object ACL**: Maximum 100 granted permissions
- **Object Tags**: Maximum 10 tags per object
- **Lifecycle Constraints**: 30-day minimum for IA transitions
- **Glacier Retrieval**: Various retrieval times and costs

---

## Troubleshooting Common Issues

### Access Issues
- **403 Forbidden**: Check bucket policies, IAM policies, and ACLs
- **Cross-Account Access**: Verify both resource-based and user-based permissions
- **Pre-signed URLs**: Check expiration and permissions

### Performance Issues
- **High Request Rates**: Implement request pattern optimization
- **Large File Uploads**: Use multipart upload for files >100MB
- **Geographic Latency**: Consider Transfer Acceleration or CloudFront

### Replication Issues
- **CRR Not Working**: Verify versioning enabled on both buckets
- **Permissions**: Check replication IAM role permissions
- **Object Filters**: Verify prefix and tag filters are correct

### Cost Issues
- **Unexpected Charges**: Review storage classes and lifecycle policies
- **Data Transfer**: Monitor inter-region transfer costs
- **Request Charges**: Analyze request patterns and optimize