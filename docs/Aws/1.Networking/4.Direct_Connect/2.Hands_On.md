# AWS Direct Connect Hands-On Labs

## Lab 1: Setting Up AWS Direct Connect Virtual Interface (VIF)

### Prerequisites
- AWS Account with appropriate permissions
- Understanding of VPC concepts
- Existing VPC with Virtual Private Gateway attached

### Task 1.1: Create a Virtual Private Gateway
1. **Navigate to VPC Console**
   - Go to AWS Management Console
   - Search for "VPC" and select VPC service
   - Click on "Virtual Private Gateways" in the left navigation

2. **Create Virtual Private Gateway**
   ```
   Name: MyDXGateway
   Amazon Default ASN: Yes (or specify custom ASN 64512-65535)
   ```
   - Click "Create Virtual Private Gateway"
   - Note the VGW ID (e.g., vgw-xxxxxxxxx)

3. **Attach VGW to VPC**
   - Select the created VGW
   - Click "Actions" → "Attach to VPC"
   - Select your target VPC
   - Click "Yes, Attach"

### Task 1.2: Create Direct Connect Connection (Simulation)
*Note: In real scenarios, this requires physical connection setup through AWS or partners*

1. **Navigate to Direct Connect Console**
   - Go to AWS Management Console
   - Search for "Direct Connect"
   - Click on "Connections" in left navigation

2. **Simulate Connection Details**
   ```
   Connection Name: MyDXConnection
   Location: [Nearest DX Location]
   Port Speed: 1 Gbps
   VLAN: 100 (example)
   ```

### Task 1.3: Create Private Virtual Interface (VIF)
1. **In Direct Connect Console**
   - Click "Virtual Interfaces" in left navigation
   - Click "Create Virtual Interface"

2. **Configure Private VIF**
   ```
   Type: Private
   Virtual Interface Name: MyPrivateVIF
   Connection: [Select your DX connection]
   Virtual Interface Owner: My AWS account
   VLAN: 100
   BGP ASN: 65000 (customer side)
   ```

3. **IP Configuration**
   ```
   Customer Router IP: 192.168.1.1/30
   Amazon Router IP: 192.168.1.2/30
   BGP Auth Key: [Generate or specify]
   ```

4. **Associate with Virtual Private Gateway**
   - Select the VGW created in Task 1.1
   - Click "Create Virtual Interface"

## Lab 2: Configure Public Virtual Interface for S3 Access

### Task 2.1: Create Public VIF
1. **Create Public Virtual Interface**
   ```
   Type: Public
   Virtual Interface Name: MyPublicVIF
   Connection: [Select your DX connection]
   VLAN: 200
   BGP ASN: 65001
   ```

2. **Public IP Configuration**
   ```
   Customer Router IP: [Your public IP]/30
   Amazon Router IP: [AWS provided IP]/30
   Prefixes to Advertise: [Your public IP ranges]
   ```

### Task 2.2: Test S3 Access
1. **Configure Route Advertisements**
   - Advertise specific prefixes to AWS
   - Receive AWS public prefixes

2. **Test Connectivity**
   ```bash
   # From on-premises
   aws s3 ls --region us-east-1
   # Should route through Direct Connect
   ```

## Lab 3: Implement Direct Connect Gateway

### Task 3.1: Create Direct Connect Gateway
1. **Navigate to Direct Connect Console**
   - Click "Direct Connect Gateways"
   - Click "Create Direct Connect Gateway"

2. **Configure DX Gateway**
   ```
   Name: MyDXGateway
   Amazon Side ASN: 64512
   ```
   - Click "Create Direct Connect Gateway"

### Task 3.2: Associate VGWs with DX Gateway
1. **Create Association**
   - Select the DX Gateway
   - Click "Gateway Associations" tab
   - Click "Associate Gateway"

2. **Configure Association**
   ```
   Associated Gateway Type: Virtual Private Gateway
   Virtual Private Gateway: [Select your VGW]
   Allowed Prefixes: 10.0.0.0/16 (or your VPC CIDR)
   ```

### Task 3.3: Connect Multiple VPCs
1. **Create Additional VPCs** (if not existing)
   ```
   VPC Name: DX-VPC-2
   CIDR: 10.1.0.0/16
   ```

2. **Create Additional VGW**
   - Follow Task 1.1 steps for second VPC

3. **Associate Second VGW**
   - Repeat Task 3.2 for the new VGW
   - Use different allowed prefixes (10.1.0.0/16)

## Lab 4: Configure Route Propagation and BGP

### Task 4.1: Enable Route Propagation
1. **Navigate to Route Tables**
   - Go to VPC Console → Route Tables
   - Select route table associated with your VPC

2. **Enable Propagation**
   - Click "Route Propagation" tab
   - Click "Edit Route Propagation"
   - Check "Propagate" for your VGW
   - Click "Save"

### Task 4.2: Configure Custom Routes
1. **Add Static Routes** (if needed)
   ```
   Destination: 192.168.0.0/16
   Target: [Your VGW ID]
   ```

2. **Verify Routes**
   - Check route table entries
   - Verify propagated routes appear

## Lab 5: Set Up High Availability (HA)

### Task 5.1: Create Second Direct Connect Connection
1. **Create Redundant Connection**
   ```
   Connection Name: MyDXConnection-Backup
   Location: [Different DX Location for HA]
   Port Speed: 1 Gbps
   ```

### Task 5.2: Configure Link Aggregation Group (LAG)
1. **Create LAG**
   - Go to Direct Connect Console
   - Click "LAGs" → "Create LAG"

2. **Configure LAG**
   ```
   LAG Name: MyLAG
   Connections: [Select both DX connections]
   Minimum Links: 1
   ```

### Task 5.3: Enable Bidirectional Forwarding Detection (BFD)
1. **Configure BFD on VIF**
   - Edit your Virtual Interface
   - Enable "Bidirectional Forwarding Detection"
   - Set BFD parameters for faster failover detection

## Lab 6: Monitor and Troubleshoot

### Task 6.1: Set Up CloudWatch Monitoring
1. **Enable DX Metrics**
   - Go to CloudWatch Console
   - Navigate to "Metrics" → "Direct Connect"

2. **Create Alarms**
   ```
   Metric: ConnectionState
   Threshold: < 1 (Down state)
   Action: SNS notification
   ```

### Task 6.2: Verify Connectivity
1. **Test Private VIF**
   ```bash
   # From on-premises
   ping [VPC private IP]
   traceroute [VPC private IP]
   ```

2. **Test Public VIF**
   ```bash
   # Test S3 access
   nslookup s3.amazonaws.com
   # Should resolve to Direct Connect path
   ```

### Task 6.3: BGP Session Verification
1. **Check BGP Status**
   - In Direct Connect Console
   - View Virtual Interface details
   - Verify BGP session state is "Up"

2. **Review Route Tables**
   - Check advertised routes
   - Verify received routes from AWS

## Lab 7: Security and Encryption

### Task 7.1: Set Up VPN over Direct Connect
1. **Create Customer Gateway**
   ```
   Name: DX-VPN-CGW
   IP Address: [Your public IP]
   BGP ASN: 65000
   ```

2. **Create VPN Connection**
   ```
   Name: DX-VPN-Connection
   Customer Gateway: [Select created CGW]
   Virtual Private Gateway: [Select your VGW]
   Routing: Dynamic (BGP)
   ```

### Task 7.2: Configure IPSec Tunnel
1. **Download VPN Configuration**
   - Select VPN connection
   - Click "Download Configuration"
   - Choose your router vendor

2. **Apply Configuration**
   - Configure IPSec tunnels on customer router
   - Verify tunnel establishment

## Lab 8: Cost Optimization

### Task 8.1: Review Billing
1. **Check Direct Connect Costs**
   - Go to AWS Billing Console
   - Review Direct Connect charges
   - Analyze port hours and data transfer costs

### Task 8.2: Optimize Usage
1. **Review Data Transfer Patterns**
   - Use CloudWatch metrics
   - Identify peak usage times
   - Consider lower bandwidth options if appropriate

2. **Evaluate Partner Connections**
   - Research APN partner options for lower speeds
   - Compare costs for 50Mbps-500Mbps options

## Verification Checklist

- [ ] Virtual Private Gateway created and attached
- [ ] Private VIF configured and connected
- [ ] Public VIF configured for AWS services
- [ ] Direct Connect Gateway implemented
- [ ] Route propagation enabled
- [ ] High availability configured
- [ ] Monitoring and alarms set up
- [ ] Security measures implemented
- [ ] Cost optimization reviewed

## Common Troubleshooting Steps

1. **BGP Session Issues**
   - Verify ASN numbers match configuration
   - Check IP addressing (/30 subnets)
   - Confirm VLAN tags are unique

2. **Routing Problems**
   - Verify route propagation is enabled
   - Check route table entries
   - Confirm prefix advertisements

3. **Connectivity Issues**
   - Test layer 3 connectivity
   - Verify security group rules
   - Check NACLs configuration

## Additional Resources

- AWS Direct Connect User Guide
- AWS Direct Connect Partners
- BGP Configuration Best Practices
- Direct Connect Monitoring Guide