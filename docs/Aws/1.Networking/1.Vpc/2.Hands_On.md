# AWS VPC Hands-On Tasks - Step by Step Guide

## Lab 1: Create a Custom VPC with Public Subnet

### Prerequisites
- AWS Account with appropriate permissions
- AWS CLI installed (optional)
- Basic understanding of networking concepts

### Task 1.1: Create a Custom VPC
1. **Navigate to VPC Console**
   - Log into AWS Console
   - Go to VPC service
   - Click "Create VPC"

2. **Configure VPC Settings**
   - Name tag: `MyCustomVPC`
   - IPv4 CIDR block: `10.0.0.0/16`
   - IPv6 CIDR block: No IPv6 CIDR block
   - Tenancy: Default
   - Click "Create VPC"

3. **Verify VPC Creation**
   - Note down the VPC ID
   - Check that the VPC appears in your VPC list
   - Verify the CIDR block is correctly assigned

### Task 1.2: Create an Internet Gateway
1. **Create Internet Gateway**
   - In VPC console, click "Internet Gateways"
   - Click "Create internet gateway"
   - Name tag: `MyIGW`
   - Click "Create internet gateway"

2. **Attach Internet Gateway to VPC**
   - Select the created IGW
   - Click "Actions" → "Attach to VPC"
   - Select `MyCustomVPC`
   - Click "Attach internet gateway"

### Task 1.3: Create a Public Subnet
1. **Create Subnet**
   - Go to "Subnets" in VPC console
   - Click "Create subnet"
   - VPC ID: Select `MyCustomVPC`
   - Subnet name: `PublicSubnet-1`
   - Availability Zone: Select first available AZ
   - IPv4 CIDR block: `10.0.1.0/24`
   - Click "Create subnet"

2. **Enable Auto-assign Public IP**
   - Select the created subnet
   - Click "Actions" → "Modify auto-assign IP settings"
   - Check "Enable auto-assign public IPv4 address"
   - Click "Save"

### Task 1.4: Create and Configure Route Table
1. **Create Route Table**
   - Go to "Route Tables"
   - Click "Create route table"
   - Name: `PublicRouteTable`
   - VPC: Select `MyCustomVPC`
   - Click "Create route table"

2. **Add Route to Internet Gateway**
   - Select the created route table
   - Go to "Routes" tab
   - Click "Edit routes"
   - Click "Add route"
   - Destination: `0.0.0.0/0`
   - Target: Internet Gateway → Select `MyIGW`
   - Click "Save changes"

3. **Associate Subnet with Route Table**
   - Go to "Subnet associations" tab
   - Click "Edit subnet associations"
   - Select `PublicSubnet-1`
   - Click "Save associations"

### Task 1.5: Create Security Group
1. **Create Security Group**
   - Go to "Security Groups"
   - Click "Create security group"
   - Security group name: `WebServerSG`
   - Description: `Security group for web servers`
   - VPC: Select `MyCustomVPC`

2. **Configure Inbound Rules**
   - Add rule: Type: HTTP, Port: 80, Source: 0.0.0.0/0
   - Add rule: Type: HTTPS, Port: 443, Source: 0.0.0.0/0
   - Add rule: Type: SSH, Port: 22, Source: Your IP
   - Click "Create security group"

### Task 1.6: Launch EC2 Instance in Public Subnet
1. **Launch Instance**
   - Go to EC2 console
   - Click "Launch instance"
   - Name: `WebServer-Public`
   - AMI: Amazon Linux 2
   - Instance type: t2.micro

2. **Configure Network Settings**
   - VPC: Select `MyCustomVPC`
   - Subnet: Select `PublicSubnet-1`
   - Auto-assign public IP: Enable
   - Security group: Select `WebServerSG`
   - Launch instance

3. **Test Connectivity**
   - SSH into the instance using its public IP
   - Run: `ping google.com` to test internet connectivity

---

## Lab 2: Create VPC with Public and Private Subnets

### Task 2.1: Extend Previous VPC with Private Subnet
1. **Create Private Subnet**
   - Name: `PrivateSubnet-1`
   - VPC: `MyCustomVPC`
   - Availability Zone: Same as public subnet
   - IPv4 CIDR: `10.0.2.0/24`
   - Don't enable auto-assign public IP

### Task 2.2: Create NAT Gateway
1. **Create NAT Gateway**
   - Go to "NAT Gateways"
   - Click "Create NAT gateway"
   - Name: `MyNATGateway`
   - Subnet: Select `PublicSubnet-1`
   - Connectivity type: Public
   - Click "Allocate Elastic IP"
   - Click "Create NAT gateway"

### Task 2.3: Create Private Route Table
1. **Create Route Table**
   - Name: `PrivateRouteTable`
   - VPC: `MyCustomVPC`

2. **Add Route to NAT Gateway**
   - Edit routes
   - Add route: Destination: `0.0.0.0/0`, Target: NAT Gateway → Select `MyNATGateway`
   - Save changes

3. **Associate with Private Subnet**
   - Associate `PrivateSubnet-1` with `PrivateRouteTable`

### Task 2.4: Launch Instance in Private Subnet
1. **Create Database Security Group**
   - Name: `DatabaseSG`
   - VPC: `MyCustomVPC`
   - Inbound rule: Type: MySQL/Aurora, Port: 3306, Source: `WebServerSG`

2. **Launch Database Instance**
   - Name: `DatabaseServer-Private`
   - VPC: `MyCustomVPC`
   - Subnet: `PrivateSubnet-1`
   - Security group: `DatabaseSG`
   - No public IP

3. **Test Connectivity**
   - SSH into public instance
   - From public instance, SSH into private instance using private IP
   - Test internet connectivity from private instance

---

## Lab 3: Multi-AZ VPC Setup

### Task 3.1: Create Multi-AZ Subnets
1. **Create Second Public Subnet**
   - Name: `PublicSubnet-2`
   - VPC: `MyCustomVPC`
   - Availability Zone: Different from first subnet
   - IPv4 CIDR: `10.0.3.0/24`
   - Enable auto-assign public IP

2. **Create Second Private Subnet**
   - Name: `PrivateSubnet-2`
   - VPC: `MyCustomVPC`
   - Availability Zone: Same as `PublicSubnet-2`
   - IPv4 CIDR: `10.0.4.0/24`

### Task 3.2: Create Second NAT Gateway
1. **Create NAT Gateway in Second AZ**
   - Name: `MyNATGateway-2`
   - Subnet: `PublicSubnet-2`
   - Allocate new Elastic IP

2. **Create Second Private Route Table**
   - Name: `PrivateRouteTable-2`
   - Add route to `MyNATGateway-2`
   - Associate with `PrivateSubnet-2`

3. **Associate Public Subnet with Public Route Table**
   - Associate `PublicSubnet-2` with `PublicRouteTable`

---

## Lab 4: VPC Peering Configuration

### Task 4.1: Create Second VPC
1. **Create Another VPC**
   - Name: `SecondVPC`
   - IPv4 CIDR: `10.1.0.0/16`
   - Create subnet: `10.1.1.0/24`

### Task 4.2: Set Up VPC Peering
1. **Create Peering Connection**
   - Go to "Peering Connections"
   - Click "Create peering connection"
   - Name: `VPC-Peering-Connection`
   - Requester VPC: `MyCustomVPC`
   - Accepter VPC: `SecondVPC`
   - Click "Create peering connection"

2. **Accept Peering Connection**
   - Select the peering connection
   - Click "Actions" → "Accept request"

3. **Update Route Tables**
   - In `MyCustomVPC` route tables, add route: `10.1.0.0/16` → Peering connection
   - In `SecondVPC` route tables, add route: `10.0.0.0/16` → Peering connection

4. **Update Security Groups**
   - Allow traffic from peer VPC CIDR blocks

### Task 4.3: Test Peering Connection
1. **Launch Instances in Both VPCs**
2. **Test Connectivity**
   - Ping from instance in first VPC to instance in second VPC using private IPs

---

## Lab 5: VPC Endpoints Implementation

### Task 5.1: Create Gateway Endpoint for S3
1. **Create S3 Gateway Endpoint**
   - Go to "Endpoints"
   - Click "Create endpoint"
   - Name: `S3-Gateway-Endpoint`
   - Service category: AWS services
   - Service name: `com.amazonaws.region.s3`
   - VPC: `MyCustomVPC`
   - Route tables: Select private route tables
   - Policy: Full access

2. **Test S3 Access**
   - From private instance, test S3 access: `aws s3 ls`

### Task 5.2: Create Interface Endpoint for EC2
1. **Create EC2 Interface Endpoint**
   - Service name: `com.amazonaws.region.ec2`
   - VPC: `MyCustomVPC`
   - Subnets: Select private subnets
   - Security group: Allow HTTPS (443) from VPC CIDR

---

## Lab 6: Network ACLs Configuration

### Task 6.1: Create Custom NACL
1. **Create Network ACL**
   - Name: `WebTierNACL`
   - VPC: `MyCustomVPC`

2. **Configure Inbound Rules**
   - Rule 100: HTTP (80) from 0.0.0.0/0 - ALLOW
   - Rule 110: HTTPS (443) from 0.0.0.0/0 - ALLOW
   - Rule 120: SSH (22) from your IP - ALLOW
   - Rule 130: Custom TCP 1024-65535 from 0.0.0.0/0 - ALLOW (for return traffic)

3. **Configure Outbound Rules**
   - Rule 100: HTTP (80) to 0.0.0.0/0 - ALLOW
   - Rule 110: HTTPS (443) to 0.0.0.0/0 - ALLOW
   - Rule 120: Custom TCP 1024-65535 to 0.0.0.0/0 - ALLOW

4. **Associate with Subnet**
   - Associate `PublicSubnet-1` with `WebTierNACL`

---

## Lab 7: VPC Flow Logs Setup

### Task 7.1: Create VPC Flow Logs
1. **Enable Flow Logs**
   - Select your VPC
   - Go to "Flow logs" tab
   - Click "Create flow log"
   - Filter: All
   - Destination: Send to CloudWatch Logs
   - Log group: `/aws/vpc/flowlogs`
   - IAM role: Create new role or use existing

2. **View Flow Logs**
   - Go to CloudWatch
   - Navigate to Log groups
   - View flow log entries

---

## Lab 8: Site-to-Site VPN Configuration

### Task 8.1: Create Virtual Private Gateway
1. **Create VGW**
   - Go to "Virtual private gateways"
   - Click "Create virtual private gateway"
   - Name: `MyVGW`
   - Click "Create virtual private gateway"

2. **Attach to VPC**
   - Select VGW
   - Click "Attach to VPC"
   - Select `MyCustomVPC`

### Task 8.2: Create Customer Gateway
1. **Create Customer Gateway**
   - Name: `MyCustomerGW`
   - Routing: Static
   - IP address: Your public IP address
   - Click "Create customer gateway"

### Task 8.3: Create VPN Connection
1. **Create Site-to-Site VPN**
   - Name: `MySiteToSiteVPN`
   - Virtual private gateway: Select `MyVGW`
   - Customer gateway: Select `MyCustomerGW`
   - Routing: Static
   - Static IP prefixes: Your on-premises network CIDR

---

## Lab 9: Troubleshooting and Monitoring

### Task 9.1: VPC Reachability Analyzer
1. **Use Reachability Analyzer**
   - Go to "Reachability Analyzer"
   - Create path analysis between two resources
   - Analyze connectivity issues

### Task 9.2: Network Performance Monitoring
1. **Set Up CloudWatch Metrics**
   - Monitor VPC metrics
   - Set up alarms for network performance

### Task 9.3: Security Analysis
1. **Review Security Groups**
   - Use security group analyzer
   - Check for overly permissive rules

2. **Review NACLs**
   - Validate NACL rules
   - Ensure proper traffic flow

---

## Lab 10: Clean Up Resources

### Task 10.1: Delete Resources (In Order)
1. **Terminate EC2 Instances**
2. **Delete NAT Gateways**
3. **Release Elastic IPs**
4. **Delete VPC Endpoints**
5. **Delete VPN Connections**
6. **Delete Customer Gateways**
7. **Detach and Delete Virtual Private Gateways**
8. **Delete Peering Connections**
9. **Delete Route Tables** (except default)
10. **Delete Subnets**
11. **Detach and Delete Internet Gateways**
12. **Delete Security Groups** (except default)
13. **Delete NACLs** (except default)
14. **Delete VPC**

---

## Verification Checklist

After completing each lab, verify:

- [ ] All resources are properly configured
- [ ] Connectivity works as expected
- [ ] Security groups allow appropriate traffic
- [ ] Route tables have correct routes
- [ ] Instances can communicate as designed
- [ ] Internet connectivity works where needed
- [ ] Private resources remain private
- [ ] Monitoring and logging are functional

---

## Additional Exercises

### Exercise 1: Design a Three-Tier Architecture
Create a VPC with:
- Web tier (public subnet)
- Application tier (private subnet)
- Database tier (private subnet)
- Proper security groups and NACLs

### Exercise 2: Implement High Availability
- Multi-AZ deployment
- Multiple NAT Gateways
- Load balancers across AZs
- Auto Scaling groups

### Exercise 3: Cost Optimization
- Compare NAT Gateway vs NAT Instance costs
- Optimize VPC endpoint usage
- Review data transfer costs

### Exercise 4: Security Hardening
- Implement least privilege access
- Use VPC Flow Logs for security monitoring
- Configure AWS Config rules for compliance

---

## Best Practices Learned

1. **Always use multiple AZs** for high availability
2. **Separate tiers** using different subnets
3. **Use security groups** as primary security mechanism
4. **Implement least privilege** access principles
5. **Monitor network traffic** using Flow Logs
6. **Plan IP addressing** carefully to avoid conflicts
7. **Use VPC endpoints** to reduce data transfer costs
8. **Implement proper routing** for traffic flow
9. **Regular security reviews** of access rules
10. **Document network architecture** for team reference